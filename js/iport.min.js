var mjcore={MJ_VERTICAL_SCROLLBAR_WIDTH:20,MJ_HORIZONTAL_SCROLLBAR_HEIGHT:20,debug:function(n){if(window.console)try{console.log(n)}catch(t){}},mjError:function(n){if(window.console)try{console.log(n)}catch(t){}},isEmpty:function(n){return n===null||n===undefined},generateId:function(){return MAX_SAFE_INTEGER=9007199254740991,Math.floor(Math.random()*MAX_SAFE_INTEGER)},clone:function(n){return $.extend({},n)},isInt:function(n){if(this.isEmpty(n))return!1;return/^[-+]?\d+$/.test(n)},isNumber:function(n){return!isNaN(n)},isHex:function(n){if(!n)return!1;return/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(n)},validate:function(n,t,i){for(var r=0;r<t.length;r++)if(n==t[r].val||String(n)==String(t[r].val))return t[r].to;return i},validateInt:function(n,t,i){return this.isInt(n)?t&&t.length>0&&t.indexOf(n)==-1?i:parseInt(n,10):i},validateFloat:function(n,t){if(this.isEmpty(t)&&(t=0),this.isEmpty(n))return t;var n=parseFloat(n);return isNaN(n)?t:n},validateString:function(n,t,i){return(this.isEmpty(i)&&(i=""),this.isEmpty(n))?i:t&&t.length>0&&t.indexOf(n)==-1?i:n},validateBool:function(n,t){return(this.isEmpty(t)&&(t=!1),n=="true"||n=="TRUE")?!0:n=="false"||n=="FALSE"?!1:n!=!0&&n!=!1?t:n},getBrowserName:function(){var n=navigator.userAgent.toLowerCase();return n.indexOf("firefox")>-1?"firefox":n.indexOf("chrome")>-1?"chrome":n.indexOf("msie")>-1?"msie":n.indexOf("trident")>-1?"msie":n.indexOf("safari")>-1?"safari":n.indexOf("opera")>-1?"opera":"unknown"},isTouchScreen:function(){var n=navigator.userAgent.toLowerCase();return"ontouchstart"in document.documentElement||n.match(/(iphone|ipod|ipad)/)||n.match(/(android)/)||n.match(/(iemobile)/)||n.match(/iphone/i)||n.match(/ipad/i)||n.match(/ipod/i)||n.match(/blackberry/i)||n.match(/bada/i)},findIndex:function(n,t){if(!n||!t)return-1;for(var i=0,r=n.length;i<r;i++)if(t(n[i]))return i;return-1},find:function(n,t){if(!n||!t)return null;for(var i=0,r=n.length;i<r;i++)if(t(n[i]))return n[i];return null},htmlEncode:function(n){return String(n).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlDecode:function(n){return String(n).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},mjCollection:function(n){this.collection={};this.add=function(n,t){if(this.collection[n]!=undefined)return undefined;this.collection[n]=t};this.remove=function(n){if(this.collection[n]==undefined)return undefined;delete this.collection[n]};this.reset=function(n){if(this.collection={},n!=undefined)for(var t in n)n[t].id!=undefined&&this.add(n[t].id,n[t])};this.get=function(n){return this.collection[n]};this.set=function(n,t){this.collection[n]=t};this.forEach=function(n){for(key in this.collection)this.collection.hasOwnProperty(key)&&n(this.collection[key])};this.reset(n)}};$(document).ready(function(){(function(n){var t={_init:function(t,i){return this.widget_class="mjListBox",this.el=i,this.$el=n(i),this._validateData(t),this.original_data=[],this.start=0,this.close(),this._render(),this._startListening(),this},_renderItemButton:function(n){var i="",r,t;if(!this.isCheckable())return i;r=this.settings;t="";switch(n.checked){case 1:t=" checked";break;case 2:t=" half-ticked"}switch(r.type){case"checkbox":i="<div class='mj-cell mj-checkbox-cell'><div class='mj-checkbox-box"+t+"'><div class='mj-tick'><\/div><\/div><\/div>";break;case"radiobutton":i="<div class='mj-cell mj-radio-cell'><div class='mj-radio"+t+"'><div class='mj-dot'><\/div><\/div><\/div>"}return i},_renderImage:function(n){return n.image?"<div class='mj-cell mj-image-cell'><div class='mj-image'><img src='"+n.image+"' /><\/div><\/div>":""},_renderText:function(t){var u=this.settings,f="",r,i;return u.itemRender?f+="<div class='mj-cell'>"+u.itemRender(t)+"<\/div>":(r=t.text,i=t.text,n.isFunction(t.text)&&(r=t.text(),i=""),i.indexOf("<")>-1&&(i=""),f+=u.wrap_text?"<div class='mj-cell mj-text-cell'><div class='mj-text' title='"+i+"'>"+r+"<\/div><\/div>":"<div class='mj-cell mj-text-cell'><div class='mj-text mj-nowrap' title='"+i+"'>"+r+"<\/div><\/div>"),f},_renderItem:function(t){for(var i,e,u=this.settings,r="<div class='mj-row' tabindex=1 >",f=0;f<u.component_order.length;f++)switch(u.component_order[f]){case"button":r+=this._renderItemButton(t);break;case"image":r+=this._renderImage(t);break;case"text":r+=this._renderText(t)}return r+="<\/div>",i=n(r),t.disabled&&i.addClass("mj-disabled"),t.selected&&!this.isCheckable()&&i.addClass("mj-selected"),u.virtual_mode?i.data("d",t):(e=mjcore.clone(t),i.data("d",e)),i},_redraw:function(t,i){var f=this,u=this.settings,r,e;if(t||(t=u.items),i||(i=this.$el.find(".mj-table")),u.virtual_mode)for(i.empty(),r=this.start;r<this.start+u.page_size;r++)e=t[r],i.append(f._renderItem(e,r*100));else n.each(t,function(n,t){i.append(f._renderItem(t,n*100))})},_createScrollBars:function(){var e=this,t,n;if(!mjcore.isTouchScreen()&&(t=this.settings,t.virtual_mode)){this.$el.find(".mj-listbox").css("overflow","hidden");var o=this.$el.find(".mj-listbox"),r=o.width(),u=this.$el.find(".mj-table").width(),f=0,i=0,n;if(u>r&&(f=mjcore.MJ_HORIZONTAL_SCROLLBAR_HEIGHT),t.items.length>t.page_size&&(i=mjcore.MJ_VERTICAL_SCROLLBAR_WIDTH),f>0){n=this.$el.find(".mj-listbox-horizontal-scrollbar");n.css({right:i+"px",height:mjcore.MJ_HORIZONTAL_SCROLLBAR_HEIGHT});i>0?n.mjScrollBar({min:0,max:u-r+mjcore.MJ_VERTICAL_SCROLLBAR_WIDTH,orientation:"horizontal",page_size:t.page_size}):n.mjScrollBar({min:0,max:u-r,orientation:"horizontal",page_size:t.page_size});n.on("valueChanged",function(n,t){e.$el.find(".mj-cell").css("left",-t)})}else n=this.$el.find(".mj-listbox-horizontal-scrollbar .mj-scrollbar"),n.length&&this.$el.find(".mj-listbox-horizontal-scrollbar").mjScrollBar("close");if(i>0){n=this.$el.find(".mj-listbox-vertical-scrollbar");n.css({bottom:f+"px",width:mjcore.MJ_VERTICAL_SCROLLBAR_WIDTH});n.mjScrollBar({min:0,max:t.items.length-t.page_size,page_size:t.page_size});n.on("valueChanged",function(n,t){e.scroll(t)})}else n=this.$el.find(".mj-listbox-vertical-scrollbar .mj-scrollbar"),n.length&&this.$el.find(".mj-listbox-vertical-scrollbar").mjScrollBar("close")}},_render:function(){var e=this,t=this.settings,i=n("<div>",{"class":"mj-widget mj-listbox"}),r=n("<div>",{"class":"mj-table"}),u,f;return t.horizontal&&r.addClass("mj-horizontal"),i.append(r),this._redraw(t.items,r),this.$el.html(i),t.virtual_mode&&(u=n("<div>",{"class":"mj-listbox-vertical-scrollbar"}),f=n("<div>",{"class":"mj-listbox-horizontal-scrollbar"}),i.append(u),i.append(f),this._createScrollBars()),t.max_text_width&&this.$el.find(".mj-text").css({width:t.max_text_width}),mjcore.isEmpty(t.width)||t.width=="auto"||this.$el.find(".mj-widget").css("width",t.width),mjcore.isEmpty(t.height)||t.height=="auto"||this.$el.find(".mj-widget").css("height",t.height),this.saveState(),this},_validateItem:function(t){var i=n.extend({},{id:null,text:"",image:null,selected:!1,checked:0,disabled:!1},t);if(n.extend(t,i),mjcore.isEmpty(t.id)&&(t.id=mjcore.generateId()),this.isCheckable()){switch(String(t.checked)){case"false":t.checked=0;break;case"true":t.checked=1;break;case"0":t.checked=0;break;case"1":t.checked=1;break;case"2":t.checked=2;break;default:t.checked=0}t.selected=null}else{switch(String(t.selected)){case"false":t.selected=!1;break;case"true":t.selected=!0;break;case"0":t.selected=!1;break;case"1":t.selected=!0;break;default:t.selected=!1}t.checked=null}switch(String(t.disabled)){case"false":t.disabled=!1;break;case"true":t.disabled=!0;break;case"0":t.disabled=!1;break;case"1":t.disabled=!0;break;default:t.disabled=!1}},_validateData:function(t){var r,i;this.settings=n.extend({},{items:[],type:"text",multi_select:!1,component_order:["button","image","text"],max_text_width:null,itemRender:null,dragdrop:!1,enable_hover:!0,horizontal:!1,wrap_text:!1,virtual_mode:!1,page_size:15,stack_components:!1,width:"auto",height:"auto",disabled:!1,theme:null},t);r=this;i={};n.each(this.settings.items,function(n,t){r._validateItem(t);i[t.id]&&mjcore.mjError("mjListBox Error: duplicate id: "+t.id+" found in data. Ids must be unique.");i[t.id]=t.id})},_startListening:function(){var t=this,i=this.settings;if(this._stopListening(),i.enable_hover&&this.$el.find(".mj-row").hover(function(){n(this).addClass("mj-hover")},function(){n(this).removeClass("mj-hover")}),i.virtual_mode&&mjcore.isTouchScreen()){this.$el.on("touchstart",this,this._touchstart);this.$el.on("touchmove",this,this._touchmove);this.$el.on("touchend",this,this._touchend)}if(!mjcore.isTouchScreen())this.$el.on("mousewheel DOMMouseScroll wheel",".mj-row",function(n){n.preventDefault();var r=t.start;n.originalEvent.wheelDelta>0?r--:r++;r>=0&&r<i.items.length&&(t.scroll(r),n=t.$el.find(".mj-listbox-vertical-scrollbar"),n.mjScrollBar("set",r))});this.$el.on("click",".mj-image",function(i){i.preventDefault();var r=n(i.currentTarget).closest(".mj-row");t.$el.trigger("imageClick",r.data())});this.$el.on("click",".mj-row",function(r){r.preventDefault();r.stopPropagation();var f=n(r.currentTarget),u=f.data("d");if(!u){mjcore.mjError("mjListBox: item click: item data not found");return}if(!u.disabled)switch(i.type){case"checkbox":case"radiobutton":t._toggle(f);t.$el.trigger("checkChange",u);break;default:t._select(f);t.$el.trigger("selected",u)}});i.dragdrop&&this.$el.find(".mj-listbox .mj-table").sortable({update:function(){i.items=[];n.each(t.$el.find(".mj-row"),function(t,r){var u=n(r).data("d");i.items.push(u)});t.$el.trigger("dragend")}});this._enableKeyEvents()},_touchstart:function(n){n.preventDefault();var i=n.data,t=n.originalEvent,r=0;r=t.touches?t.touches[0].pageY:t.pageY;i.touch_y=r;i.touch_busy=!1},_touchmove:function(n){var t=n.data,r,i,u,h;if((console.log("touchmove"),r=n.originalEvent,i=0,i=r.touches?r.touches[0].pageY:r.pageY,i!=t.touch_y)&&!t.touch_busy){var f=t.settings,e=t.$el.height(),o=i-t.touch_y,s=o/e;(t.touch_y=i,u=f.items.length,i=t.start+Math.floor((u-f.page_size)*s),i<0||i>=u)||(t.touch_busy=!0,h=t.scroll(i),t.touch_busy=!1)}},_touchend:function(n){var t=n.data;t.touch_busy=!1},_enableKeyEvents:function(){var t=this;this.$el.on("keydown","li",function(i){var e=i.keyCode,u=n(i.currentTarget),f,r;switch(e){case 32:i.preventDefault();r=n(u).data("d");r&&t.toggle(r.id);break;case 38:i.preventDefault();setTimeout(function(){u.prev().focus()},0);f=n(u.prev());r=n(u.prev()).data("d");r&&(t.isCheckable()||t._select(f),t.$el.trigger("arrowIn",r));break;case 40:i.preventDefault();setTimeout(function(){u.next().focus()},0);f=n(u.next());r=n(u.next()).data("d");r&&(t.isCheckable()||t._select(f),t.$el.trigger("arrowIn",r))}});this.$el.on("focusout","li",function(){});var i=-1,r=this.toArray(),i=mjcore.findIndex(r,function(n){return n.selected||n.checked==1});i!=-1&&this.$el.find("li:eq("+i+")")&&setTimeout(function(){t.$el.find("li:eq("+i+")").focus()},0)},_stopListening:function(){this.$el.off()},getElement:function(t){var r=this.$el.find(".mj-row"),i=r.filter(function(){return n(this).data("d").id==t});return i.length==0?null:i},getElementAt:function(n){var t=this.$el.find(".mj-row:eq("+n+")").first();return t&&t.length>0?t:null},isCheckable:function(){return this.settings.type=="checkbox"||this.settings.type=="radiobutton"},getItem:function(n){var i=this.settings,t;return i.virtual_mode?mjcore.find(i.items,function(t){return t.id==n}):(t=this.getElement(n),!t)?null:t.data("d")},getItems:function(){return this.toArray()},toArray:function(){var i=this.settings,r,t;return i.virtual_mode?i.items:(r=this.$el.find(".mj-row"),t=[],n.each(r,function(i,r){t.push(n(r).data("d"))}),t)},getItemAt:function(t){var r=this.settings,i;return r.virtual_mode?t<0||t>=r.items.length?null:r.items[t]:(i=this.$el.find(".mj-row"),!i||i.length==0)?null:t<0||t>=i.length?null:n(i[t]).data("d")},search:function(t){var i=[],r;return t?(r=this.toArray(),n.each(r,function(n,r){t(r)&&i.push(r)}),i):res},_toggle:function(n){if(n){var i=this.settings,t=n.data("d");this.isCheckable()?i.type=="radiobutton"?this._check(n):t.checked==1?this._uncheck(n):this._check(n):t.selected?this._deselect(n):this._select(n)}},toggle:function(n){var t=this.getElement(n);t&&this._toggle(t)},_check:function(n){if(n&&this.isCheckable()){var t=this.settings;switch(t.type){case"checkbox":n.data("d").checked=1;n.find(".mj-checkbox-box").addClass("checked").removeClass("half-ticked");break;case"radiobutton":this.uncheckAll();n.data("d").checked=1;n.find(".mj-radio").addClass("checked")}}},check:function(n){var t,i,r;this.isCheckable()&&(t=this.settings,t.virtual_mode?(i=mjcore.find(t.items,function(t){return t.id==n}),i&&(i.checked=1),this._redraw()):(r=this.getElement(n),this._check(r)))},checkAt:function(n){var t,i;if(this.isCheckable())if(t=this.settings,t.virtual_mode){if(n<0||n>=t.items.length)return;t.items[n].checked=1;this._redraw()}else{if(i=this.getElementAt(n),!i)return;this._check(i)}},_uncheck:function(n){n&&(n.data("d").checked=0,n.find(".mj-checkbox-box").removeClass("checked").removeClass("half-ticked"),n.find(".mj-radio").removeClass("checked"))},uncheck:function(n){var t,i,r;this.isCheckable()&&(t=this.settings,t.virtual_mode?(i=mjcore.find(t.items,function(t){return t.id==n}),i&&(i.checked=0,this._redraw())):(r=this.getElement(n),this._uncheck(r)))},unchecktAt:function(n){var t,i;if(this.isCheckable())if(t=this.settings,t.virtual_mode){if(n<0||n>=t.items.length)return;t.items[n].checked=0;this._redraw()}else i=this.getElementAt(n),this._uncheck(i)},getChecked:function(){var t=[],i=this.settings,r;return i.virtual_mode?n.each(i.items,function(n,i){i.checked==1&&(i.index=n,t.push(i))}):(r=this.$el.find(".mj-row"),n.each(r,function(i,r){var u=n(r).data("d");u.checked==1&&(u.index=i,t.push(u))})),t},isChecked:function(n){var t,i,r;return this.isCheckable()?(t=this.settings,t.virtual_mode?(i=mjcore.find(t.items,function(t){return t.id==n}),!i)?!1:i.checked==1:(r=this.getElement(n),!r)?!1:r.data("d").checked==1):!1},checkAll:function(){var t,i;this.isCheckable()&&(t=this.settings,t.type=="checkbox")&&(t.virtual_mode?(n.each(t.items,function(n,t){t.checked=1}),this._redraw()):(i=this.$el.find(".mj-row"),n.each(i,function(t,i){n(i).data("d").checked=1}),this.$el.find(".mj-row .mj-checkbox-box").addClass("checked").removeClass("half-ticked"),this.$el.find(".mj-row .mj-radio").addClass("checked")))},uncheckAll:function(){var t,i;this.isCheckable()&&(t=this.settings,t.virtual_mode?(n.each(t.items,function(n,t){t.checked=0}),this._redraw()):(i=this.$el.find(".mj-row"),n.each(i,function(t,i){n(i).data("d").checked=0}),this.$el.find(".mj-row .mj-checkbox-box").removeClass("checked").removeClass("half-ticked"),this.$el.find(".mj-row .mj-radio").removeClass("checked")))},halfTick:function(n){var i=this.settings,r,t;if(i.type=="checkbox")if(i.virtual_mode){if(r=mjcore.find(i.items,function(t){return t.id==n}),!r)return!1;r.checked=2;this._redraw()}else{if(t=this.getElement(n),!t)return;t.data("d").checked=2;t.find(".mj-checkbox-box").removeClass("checked").addClass("half-ticked")}},halfTickAll:function(){var t=this.settings,i;t.type=="checkbox"&&(t.virtual_mode?(n.each(t.items,function(n,t){t.checked=2}),this._redraw()):(this.$el.find(".mj-row .mj-checkbox-box").removeClass("checked").addClass("half-ticked"),i=this.$el.find(".mj-row"),n.each(i,function(t,i){n(i).data("d").checked=2})))},uncheckHalfTicked:function(){var i=this.settings,t;i.type=="checkbox"&&(this.$el.find(".mj-row .mj-checkbox-box.half-ticked").removeClass("half-ticked"),t=this.$el.find(".mj-row"),n.each(t,function(t,i){var r=n(i).data("d");r.checked==2&&(r.checked=0)}))},disable:function(n){var r=this.settings,i,t;if(r.virtual_mode){if(i=mjcore.find(r.items,function(t){return t.id==n}),!i)return!1;i.disabled=!0;this._redraw()}else{if(t=this.getElement(n),!t)return;t.data("d").disabled=!0;t.addClass("mj-disabled")}},disableAt:function(n){var i=this.settings,t;if(i.virtual_mode){if(n<0||n>=i.items.length)return!1;i.items[n].disabled=!0;this._redraw()}else{if(t=this.getElementAt(n),!t)return;t.data("d").disabled=!0;t.addClass("mj-disabled")}},disableAll:function(){var t=this.settings,i;t.virtual_mode?(n.each(t.items,function(n,t){t.disabled=!0}),this._redraw()):(this.$el.find(".mj-row").addClass("mj-disabled"),i=this.$el.find(".mj-row"),n.each(i,function(t,i){o=n(i).data("d").disabled=!0}))},enable:function(n){var r=this.settings,i,t;if(r.virtual_mode){if(i=mjcore.find(r.items,function(t){return t.id==n}),!i)return!1;i.disabled=!1;this._redraw()}else{if(t=this.getElement(n),!t)return;t.data("d").disabled=!1;t.removeClass("mj-disabled")}},enableAt:function(n){var i=this.settings,t;if(i.virtual_mode){if(n<0||n>=i.items.length)return!1;i.items[n].disabled=!1;this._redraw()}else{if(t=this.getElementAt(n),!t)return!1;t.data("d").disabled=!1;t.removeClass("mj-disabled")}return!0},enableAll:function(){var t=this.settings,i;t.virtual_mode?(n.each(t.items,function(n,t){t.disabled=!1}),this._redraw()):(this.$el.find(".mj-row").removeClass("mj-disabled"),i=this.$el.find(".mj-row"),n.each(i,function(t,i){n(i).data("d").disabled=!1}))},selectAll:function(){var t,i;this.isCheckable()||(t=this.settings,t.virtual_mode?(n.each(t.items,function(n,t){t.selected=!0}),this._redraw()):(i=this.$el.find(".mj-row"),n.each(i,function(t,i){n(i).data("d").selected=!0}),this.$el.find(".mj-row").addClass("mj-selected")))},deselectAll:function(){var t,i;this.isCheckable()||(t=this.settings,t.virtual_mode?(n.each(t.items,function(n,t){t.selected=!1}),this._redraw()):(i=this.$el.find(".mj-row"),n.each(i,function(t,i){n(i).data("d").selected=!1}),this.$el.find(".mj-row").removeClass("mj-selected")))},getSelected:function(){var t=[],i=this.settings,r;return i.virtual_mode?n.each(i.items,function(n,i){i.selected&&t.push(i)}):(r=this.$el.find(".mj-row"),n.each(r,function(i,r){var u=n(r).data("d");u.selected&&(u.index=i,t.push(u))})),t},isSelected:function(n){var r=this.settings,t,i;return r.virtual_mode?(t=mjcore.find(r.items,function(t){return t.id==n}),!t)?!1:t.selected:(i=this.getElement(n),!i)?!1:i.data("d").selected},_select:function(n){n&&(this.settings.multi_select||this.deselectAll(),n.data("d").selected=!0,n.addClass("mj-selected"))},select:function(n){var i,r,t;if(!this.isCheckable()){if(i=this.settings,i.virtual_mode){if(r=mjcore.find(i.items,function(t){return t.id==n}),!r)return!1;r.selected=!0;this._redraw()}else{if(t=this.getElement(n),!t)return!1;t.data("d").selected=!0;t.addClass("mj-selected")}return!0}},selectAt:function(n){var t,i;if(!this.isCheckable()){if(t=this.settings,t.virtual_mode){if(n<0||n>=t.items.length)return!1;t.items[n].selected=!0;this._redraw()}else{if(i=this.getElementAt(n),!i)return!1;i.data("d").selected=!0;i.addClass("mj-selected")}return!0}},_deselect:function(t){this.isCheckable()||t&&(n(t).data("d").selected=!1,t.removeClass("mj-selected"))},deselect:function(t){var r,u,i;if(!this.isCheckable()){if(r=this.settings,r.virtual_mode){if(u=mjcore.find(r.items,function(n){return n.id==t}),!u)return!1;u.selected=!1;this._redraw()}else{if(i=this.getElement(t),!i)return!1;n(i).data("d").selected=!1;i.removeClass("mj-selected")}return!0}},deselectAt:function(t){var i,r;if(!this.isCheckable()){if(i=this.settings,i.virtual_mode){if(t<0||t>=i.items.length)return!1;i.items[t].selected=!1;this._redraw()}else{if(r=this.getElementAt(t),!r)return!1;n(r).data("d").selected=!1;r.removeClass("mj-selected")}return!0}},add:function(n){var t,i;this._validateItem(n);t=this.settings;t.virtual_mode?(t.items.push(n),this._redraw()):(i=this._renderItem(n),this.$el.find(".mj-table").append(i))},insert:function(n,t){var i=this.settings,r,u;if(i.virtual_mode){if(r=mjcore.findIndex(i.items,function(t){return t.id==n}),r==-1)return!1;i.items.splice(r,0,t);this._redraw()}else{if(u=this.getElement(n),!u)return!1;this._validateItem(t);u.append(this._renderItem(t))}return!0},insertAt:function(n,t){var i=this.settings,r;if(i.virtual_mode){if(n<0||n>=i.items.length)return!1;i.items.splice(n,0,t);this._redraw()}else{if(r=this.getElementAt(n),!r)return!1;this._validateItem(t);r.append(this._renderItem(t))}return!0},update:function(t,i){var f=this.settings,e,r,u,o;if(f.virtual_mode){if(e=mjcore.findIndex(f.items,function(n){return n.id==t}),e==-1)return!1;f.items[e]=i;this._redraw()}else{if(r=this.getElement(t),!r)return!1;this._validateItem(i);u=r.data("d");n.removeData(r,"d");u=n.extend(u,i);o=this._renderItem(u);r.html(o)}return!0},updateAt:function(n){var i=this.settings,r,t;if(i.virtual_mode){if(n<0||n>=i.items.length)return!1;t=i.items[n];this.update(t.id)}else{if(r=this.getElementAt(n),!r)return;t=r.data("d");t&&this.update(t.id)}},remove:function(n){var t=this.settings,i,r;if(t.virtual_mode){if(i=mjcore.findIndex(t.items,function(t){return t.id==n}),i==-1)return!1;t.items.splice(i,1);this._redraw()}else{if(r=this.getElement(n),!r)return!1;r.remove()}return!0},removeAt:function(n){var t=this.settings,i;if(t.virtual_mode){if(n<0||n>=t.items.length)return!1;t.items.splice(n,1);this._redraw()}else{if(i=this.getElementAt(n),!i)return!1;i.remove()}return!0},saveState:function(){var i=this,t;this.original_data=[];t=this.toArray();n.each(t,function(n,t){i.original_data.push({checked:t.checked,selected:t.selected})})},hasChanged:function(){for(var t,i,r=this.toArray(),n=0,u=r.length,f=this.original_data.length;n<u&&n<f;n++)if(t=r[n],i=this.original_data[n],t.checked!=i.checked||t.selected!=i.selected)return!0;return!1},sort:function(t,i){var f=this,r=this.toArray(),u;t?r.sort(function(n,i){return t(n,i)}):r.sort(function(t,r){if(n.isFunction(t.text)||n.isFunction(r.text))return 0;if(i&&i.toLowerCase()!="asc"){if(t.text.toLowerCase()<r.text.toLowerCase())return 1;if(t.text.toLowerCase()>r.text.toLowerCase())return-1}else{if(t.text.toLowerCase()>r.text.toLowerCase())return 1;if(t.text.toLowerCase()<r.text.toLowerCase())return-1}return 0});u=this.$el.find(".mj-table");u.empty();this._redraw(r,u)},clear:function(){this.$el.find(".mj-row").empty();this.settings.items=[]},close:function(){this._stopListening();n.removeData(this.el,"mj-listbox-data");this.$el.html("")},scroll:function(n){var t=this.settings;t.virtual_mode&&(this.start=n,this.start<0&&(this.start=0),this.start>t.items.length&&(this.start=t.items.length-1),this._redraw())},scrollTo:function(n,t){var u=this.settings,i,r;if(u.virtual_mode)this.start=n,this._redraw();else{if(i=this.getElement(n),!i)return;r=i.position().top;t==!1?this.$el.find(".mj-row").css({scrollTop:r}):this.$el.find(".mj-row").animate({scrollTop:r},300)}}};n.fn.mjListBox=function(i){if(!this.length)return mjcore.mjError("mjListBox: the html element to attach to '"+this.selector+"' does not exist."),null;if(t[i]){var r=n(this).data("mj-listbox-data");return r?r[i].apply(r,Array.prototype.slice.call(arguments,1)):null}if(i&&typeof i!="object")mjcore.mjError("mjListBox: Method '"+i+"' does not exist in mjListBox");else return this.each(function(r,u){var f=Object.create(t);f._init(i,u);n.data(u,"mj-listbox-data",f)})}})(jQuery)});$(document).ready(function(){(function(n){var t={_init:function(t,i){return this.widget_class="mjCheckBox",this.el=i,this.$el=n(i),this.close(),this._validateData(t),this._render(),this._startListening(),this},_render:function(){var t=this.settings,i,r,u;t.original_value=t.checked;i="mj-widget mj-checkbox ";t.disabled==1&&(i+=" mj-disabled");r=n("<div>",{"class":i});r.data("data",t);i="mj-checkbox-box";switch(t.checked){case 1:i+=" checked";break;case 2:i+=" half-ticked"}return u="<div class='"+i+"'><div class='mj-tick'><\/div><\/div>",t.image&&(u+="<img class='mj-image' src='"+t.image+"' />"),u+="<div class='mj-text'>"+t.text+"<\/div>",r.html(u),this.$el.html(r),this},_validateData:function(t){var i;this.settings=n.extend({},{text:"select",checked:0,image:null,original_value:0,tristate:0,fade_duration:0,width:"auto",height:"auto",disabled:!1,theme:null},t);i=this.settings;(i.checked==undefined||i.checked==null||i.checked==!1||i.checked=="0")&&(i.checked=0);(i.checked=="1"||i.checked==!0||i.checked=="true")&&(i.checked=1);i.checked=="2"&&(i.checked=2);i.original_value=i.checked;(i.text==null||i.text==undefined)&&(i.text="");(i.disabled==undefined||i.disabled==null||i.disabled==!1)&&(i.disabled=0);(i.disabled=="1"||i.disabled==!0)&&(i.disabled=1);(i.tristate==undefined||i.tristate==null||i.tristate==!1||i.tristate=="0")&&(i.tristate=0);(i.tristate=="1"||i.tristate==!0)&&(i.tristate=1);mjcore.isNumber(i.fade_duration)||(i.fade_duration=0)},_startListening:function(){var i=this,t;this._stopListening();t=this.settings;this.$el.on("click",".mj-checkbox",function(r){var u,e,f;if(r.preventDefault(),u=n(r.currentTarget).data("data"),u.disabled!=1){if(e=n(r.currentTarget),f=e.find(".mj-checkbox-box"),u.tristate==1)switch(u.checked){case 0:f.addClass("checked").removeClass("half-ticked");u.checked=1;break;case 1:f.removeClass("checked").addClass("half-ticked");u.checked=2;break;case 2:f.removeClass("checked").removeClass("half-ticked");u.checked=0}else switch(u.checked){case 0:t.fade_duration>0?(f.addClass("checked").removeClass("half-ticked"),e.find(".mj-tick").fadeIn(t.fade_duration,function(){})):f.addClass("checked").removeClass("half-ticked");u.checked=1;break;case 1:t.fade_duration>0?e.find(".mj-tick").fadeOut(t.fade_duration,function(){f.removeClass("checked").removeClass("half-ticked")}):f.removeClass("checked").removeClass("half-ticked");u.checked=0}i.$el.trigger("checkChange",u)}})},_stopListening:function(){this.$el.off()},hasChanged:function(){return this.settings.checked!=this.settings.original_value},check:function(){this.$el.find(".mj-checkbox-box").addClass("checked").removeClass("half-ticked");this.settings.checked=1},halfTick:function(){this.$el.find(".mj-checkbox-box").addClass("checked").addClass("half-ticked");this.settings.checked=2},uncheck:function(){this.$el.find(".mj-checkbox-box").removeClass("checked").removeClass("half-ticked");this.settings.checked=0},set:function(n){switch(n){case 0:this.uncheck();break;case 1:this.check();break;case 2:this.halfTick()}},enable:function(){this.$el.find(".mj-checkbox-box").removeClass("mj-disabled");this.settings.disabled=0},disable:function(){this.$el.find(".mj-checkbox-box").addClass("mj-disabled");this.settings.disabled=1},val:function(){return this.settings},close:function(){this._stopListening();n.removeData(this.el,"mj-checkbox-data");this.$el.html("")}};n.fn.mjCheckBox=function(i){if(!this.length)return mjcore.mjError("mjCheckBox: the html element to attach to '"+this.selector+"' does not exist."),null;if(t[i]){var r=n(this).data("mj-checkbox-data");return r?r[i].apply(r,Array.prototype.slice.call(arguments,1)):null}if(typeof i!="object"&&i)mjcore.mjError("Method '"+i+"' does not exist in mjCheckBox");else return this.each(function(r,u){var f=Object.create(t);f._init(i,u);n.data(u,"mj-checkbox-data",f)})}})(jQuery)});$(document).ready(function(){(function(n){var t={init:function(t,i){this.widget_class="mjSuperGrid";this.default_settings={items:[],data_type:"tree",show_checkboxes:!1,itemRender:null,animation_duration:0,recursive:!0,multi_select:!1,dragdrop:!1,sublist_indent:16,wrap_text:!1,width:"100%",height:"100%",disabled:!1,theme:null};this.settings=n.extend({},this.default_settings,t);this.settings.items_type=="flat"&&this._createHierarchy();this._validateData(this.settings.items);this.el=i;this.$el=n(i);this.close();this._render();this._startListening()},_createHierarchy:function(){function f(t,i){var r=this;t&&n.each(t,function(t,r){n.each(i,function(n,t){r.id==t.pid&&(r.items||(r.items=[]),r.items.push(t))});f(r.items,i)})}for(var t,e=this,i=this.settings,r=[],u=0;u<i.items.length;u++)t=i.items[u],t.pid===undefined&&(t.pid=null),t.pid==null&&r.push(t);f(r,i.items);i.items=r},_validateItem:function(t){var i=n.extend({},{id:null,text:"",image:null,open_icon:null,closed_icon:null,selected:null,checked:null,disabled:!1,data:null,items:null},t);if(n.extend(t,i),t.id||(t.id=mjcore.generateId()),this.settings.show_checkboxes){switch(String(t.checked)){case"false":t.checked=0;break;case"true":t.checked=1;break;case"0":t.checked=0;break;case"1":t.checked=1;break;case"2":t.checked=2;break;default:t.checked=0}t.selected=null}else{switch(String(t.selected)){case"0":t.selected=!1;break;case"1":t.selected=!0;break;case"true":t.selected=!0;break;case"false":t.selected=!1;break;default:t.selected=!1}t.checked=null}switch(String(t.disabled)){case"0":t.disabled=!1;break;case"1":t.disabled=!0;break;case"true":t.disabled=!0;break;case"false":t.disabled=!1;break;default:t.disabled=!1}return t},_validateData:function(t){var r=this,i;t&&t.length!=0&&(i={},n.each(t,function(n,t){r._validateItem(t);i[t.id]&&mjcore.mjError("mjTreeView Error: duplicate id: "+t.id+" found in data. Ids must be unique.");i[t.id]=t.id;t.items&&r._validateData(t.items)}))},_startListening:function(){var t=this,i=this.settings;this._stopListening();this.$el.on("click",".mj-expander",function(r){r.preventDefault();r.stopPropagation();var u=n(r.currentTarget),e=u.closest(".mj-item"),f=e.data("d");u.hasClass("mj-open")?(u.removeClass("mj-open").addClass("mj-closed"),f.closed_icon&&u.css("background-image","url('"+f.closed_icon+"')"),t.$el.trigger("collapse",f)):(u.removeClass("mj-closed").addClass("mj-open"),f.open_icon&&u.css("background-image","url('"+f.open_icon+"')"),t.$el.trigger("expand",f));e.find(".mj-list:first").slideToggle(i.animation_duration)});this.$el.find("click",".mj-content").unbind("click");this.$el.on("click",".mj-content",function(r){r.preventDefault();r.stopPropagation();var u=n(r.currentTarget).data("d");if(u){if(u.disabled)return;i.show_checkboxes?(u.checked==1?t.uncheck(u.id):t.check(u.id),t.$el.trigger("checkChange",u)):(u.selected?t.deselect(u.id):t.select(u.id),t.$el.trigger("selected",u))}else mjcore.mjError("mjTreeView: node click: node "+id+" not found")});i.dragdrop&&this.$el.find(".mj-root").nestedSortable({listType:"ul",handle:"div",items:"li",isTree:!0,maxLevels:3,revert:250,doNotClear:!0,update:function(){t.toArray();t.$el.trigger("dragend")}})},_stopListening:function(){this.$el.off()},_renderItem:function(t){var o=this.settings,s=n("<li>",{"class":"mj-item"}),h=mjcore.clone(t),u,f,i,r,e,c;if(delete h.items,s.data("d",h),u=n("<div>",{"class":"mj-item-inner"}),t.items&&(f=n("<div>",{"class":"mj-expander"}),f.addClass("mj-closed"),t.closed_icon&&f.css("background-image","url('"+t.closed_icon+"')"),u.append(f)),i=n("<div>",{"class":"mj-content"}),t.disabled&&i.addClass("mj-disabled"),t.selected&&!t.disabled&&i.addClass("selected"),o.show_checkboxes){e="";switch(t.checked){case 1:e=" checked";break;case 2:e=" half-ticked"}r="<div class='mj-checkbox-box"+e+"'><div class='mj-tick'><\/div><\/div>";i.append(r)}return t.image&&(r="<img class='mj-image ' src='"+t.image+"' />",i.append(r)),this.settings.itemRender?(c=0,r=o.itemRender(t,c)):r=o.wrap_text?"<div class='mj-text'>"+t.text+"<\/div>":"<div class='mj-text mj-nowrap'>"+t.text+"<\/div>",i.append(r),i.data("d",h),u.append(i),s.append(u),s},_renderNode:function(t){var f=this,u=f._renderItem(t),i,r,e;if(t.items){for(i=n("<ul>",{"class":"mj-list"}),i.css("display","none"),r=0;r<t.items.length;r++)e=t.items[r],i.append(f._renderNode(e));u.append(i)}else u.addClass("mj-leaf");return u},_redraw:function(n,t){var f=this,i,r,u;if(t)for(i=0;i<t.length;i++)r=t[i],u=f._renderNode(r),n.append(u)},_render:function(){var t=this.settings,i=n("<div>",{"class":"mj-widget mj-treeview"}),r=n("<ul>",{"class":"mj-list mj-root"});return i.html(r),this._redraw(r,t.items),this.$el.html(i),this.$el.find(".mj-treeview .mj-item .mj-list").css("padding-left",t.sublist_indent),t.show_checkboxes&&this.$el.find(".mj-treeview .mj-leaf").css("padding-left",16),this.saveState(),this},getChildren:function(t){var r=this._getElement(t),i;return r?(i=[],n.each(r.find("li.mj-item"),function(t,r){i.push(n(r).data("d"))}),i):[]},getItem:function(n){var t=this._getElement(n);return t?t.data("d"):null},_getElement:function(t){var r=this.$el.find("li"),i=r.filter(function(){return n(this).data("d").id==t});return i.length==0?null:i},clear:function(){this.settings.items=[];var n=this.$el.find(".mj-root");n.empty()},search:function(t){if(!t)return[];var i=this.$el.find(".mj-item");return i.filter(function(){var i=n(this).data("d");return t(i)})},enableAll:function(){this.$el.find(".mj-item").removeClass("mj-disabled");n.each(this.$el.find(".mj-item"),function(t,i){n(i).data("d").disabled=!1})},disableAll:function(){this.$el.find(".mj-item").addClass("mj-disabled");n.each(this.$el.find(".mj-item"),function(t,i){n(i).data("d").disabled=!0})},enable:function(n){var t=this._getElement(n),i;t&&(i=t.data("d"),i.disabled=!1,t.removeClass("mj-disabled"))},disable:function(n){var i=this._getElement(n),t;t&&(t=i.data("d"),t.disabled=!0,i.addClass("mj-disabled"))},toggle:function(n){var t=this.getItem(n);t&&(this.settings.show_checkboxes?t.checked==1?this.uncheck(n):this.check(n):t.selected?this.deselect(n):this.select(n))},checkAll:function(){this.settings.show_checkboxes&&(n.each(this.$el.find(".mj-item"),function(t,i){n(i).data("d").checked=1}),this.$el.find(".mj-checkbox-box").addClass("checked").removeClass("half-ticked"))},uncheckAll:function(){this.settings.show_checkboxes&&(n.each(this.$el.find(".mj-item"),function(t,i){n(i).data("d").checked=0}),this.$el.find(".mj-checkbox-box").removeClass("checked").removeClass("half-ticked"))},check:function(t,i){var f=this,r,u;this.settings.show_checkboxes&&(r=this._getElement(t),r?(u=r.data("d"),u&&(u.checked=1,r.find(".mj-checkbox-box").first().addClass("checked").removeClass("half-ticked"),this.settings.recursive&&(r.find(".mj-checkbox-box").addClass("checked").removeClass("half-ticked"),n.each(r.find("li"),function(t,i){var r=n(i).data("d");r&&(r.checked=1)}),(i==!0||i==undefined)&&n.each(r.parents(".mj-item"),function(t,i){var r=n(i).data("d");r&&(r.checked=1,n(i).find(".mj-checkbox-box").first().addClass("checked").removeClass("half-ticked"))})))):mjcore.mjError("mjTreeView.check: node "+t+" not found"))},uncheck:function(t){var u,i,r;this.settings.show_checkboxes&&(u=this,i=this._getElement(t),i&&(r=i.data("d"),r?(r.checked=0,i.find(".mj-checkbox-box").removeClass("checked").removeClass("half-ticked"),n.each(i.find("li"),function(t,i){var r=n(i).data("d");r&&(r.checked=0)})):mjcore.mjError("mjTreeView.uncheck: node "+t+" not found")))},checkAt:function(t){var r=this.$el.find(".mj-item"),i;t<0||t>=r.length||(i=r[t],i&&this.check(n(i).data("d").id))},uncheckAt:function(t){var r=this.$el.find(".mj-item"),i;t<0||t>=r.length||(i=r[t],i&&this.uncheck(n(i).data("d").id))},getChecked:function(){var t=[];return n.each(this.$el.find(".mj-item"),function(i,r){n(r).data("d").checked==1&&(o.index=i,t.push(o))}),t},halfTick:function(n){var t,i;this.settings.show_checkboxes&&(t=this.getItem(n),t?(i=this._getElement(n),i&&(this.uncheck(n),t.checked=2,i.find(".mj-checkbox-box").removeClass("checked").addClass("half-ticked"))):mjcore.mjError("mjTreeView.halfTick: node "+n+" not found"))},halfTickAt:function(t){var r=this.$el.find(".mj-item"),i;t<0||t>=r.length||(i=n(r[t]).data("d"),i&&this.halfTick(i.id))},halfTickAll:function(){this.settings.show_checkboxes&&(n.each(this.$el.find(".mj-item"),function(t,i){n(i).data("d").checked=2}),this.$el.find(".mj-checkbox-box").removeClass("checked").addClass("half-ticked"))},deselectHalfTicked:function(){this.settings.show_checkboxes&&(n.each(this.$el.find(".mj-item"),function(t,i){var r=n(i).data("d");r.checked==2&&(r.checked=0)}),this.$el.find(".mj-checkbox-box.half-ticked").removeClass("half-ticked"))},select:function(n){var t,i;this.settings.show_checkboxes||(t=this._getElement(n),t)&&(i=t.data("d"),i?(this.settings.multi_select||this.deselectAll(),i.selected=!0,t.find(".mj-content:first").addClass("selected")):mjcore.mjError("mjTreeView.select: node "+n+" not found"))},deselect:function(n){var r=this,t,i;this.settings.show_checkboxes||(t=this._getElement(n),i=t.data("d"),i?(i.selected=!1,t.find(".mj-content:first").removeClass("selected")):mjcore.mjError("mjTreeView.deselect: node "+n+" not found"))},getSelected:function(){var t=[];return n.each(this.$el.find(".mj-item"),function(i,r){var u=n(r).data("d");u.selected&&(u.index=i,t.push(u))}),t},selectAll:function(){this.settings.show_checkboxes||(n.each(this.$el.find(".mj-item"),function(t,i){n(i).data("d").selected=!0}),this.$el.find(".mj-content").addClass("selected"))},deselectAll:function(){this.settings.show_checkboxes||(n.each(this.$el.find(".mj-item"),function(t,i){n(i).data("d").selected=!1}),this.$el.find(".mj-content").removeClass("selected"))},selectAt:function(t){var r=this.$el.find(".mj-content"),i;t<0||t>=r.length||(i=n(r[t]).data("d"),i&&this.select(i.id))},deselectAt:function(t){var r=this.$el.find(".mj-content"),i;t<0||t>=r.length||(i=n(r[t]).data("d"),i&&this.deselect(i.id))},toArray:function(){var t=[],i=this.$el.find("li.mj-item");return n.each(i,function(i,r){var u=n(r).data("d"),f;delete u.items;u.pid=null;f=n(r).parent().closest("li");f&&f.length>0&&(u.pid=f.data("d").id);t.push(u)}),t},toTree:function(){var t=this.toArray(),i=[];return n.each(t,function(r,u){u.pid==null&&i.push(u);n.each(t,function(n,t){t.pid&&t.pid==u.id&&(u.items||(u.items=[]),u.items.push(t))})}),i},sort:function(n){var u=this,r=this.toTree(),i,t;this._sort(r,n);i=[];t=this.$el.find(".mj-root ");t.empty();this._redraw(t,i)},_sort:function(t,i,r){var u=this;i?t.sort(function(n,t){return i(n,t)}):t.sort(function(n,t){if(r&&r.toLowerCase()!="asc"){if(n.text.toLowerCase()<t.text.toLowerCase())return 1;if(n.text.toLowerCase()>t.text.toLowerCase())return-1}else{if(n.text.toLowerCase()>t.text.toLowerCase())return 1;if(n.text.toLowerCase()<t.text.toLowerCase())return-1}return 0});n.each(t,function(n,t){t.items&&u._sort(t.items,i)})},getSiblings:function(t){var f=this,i=this._getElement(t),r=[],u;return i&&(i=i.parent(),u=i.children("li.mj-item"),n.each(u,function(t,i){var u=n(i).data("d");r.push(u)})),r},addBefore:function(n,t){var i,r,u;if(t)return n?(i=this.getItem(n),!i)?null:(this._validateItem(t),r=this._getElement(n),r&&(u=this._renderItem(t),r.prepend(u)),i.id):this.addRootNode(t)},addAfter:function(n,t){var i,r,u;return t?n?(i=this.getItem(n),!i)?null:(this._validateItem(t),r=this._getElement(n),r&&(u=this._renderItem(t),r.append(u)),i.id):this.addRootNode(t):null},addRootNode:function(n){if(!n)return null;this._validateItem(n);var t=this._renderNode(n),i=this.$el.find(".mj-root");return i.append(t),n.id},addChild:function(n,t){var r,i,f,u;return t?(r=mjcore.clone(t),!n)?this.addRootNode(r):(i=this.getItem(n),!i)?null:(this._validateItem(r),i.items=this.getChildren(i.id),i.items.push(r),f=this._renderNode(i),u=this._getElement(i.id),u&&u.replaceWith(f),i.id):null},update:function(n,t){var i,r;if(t)return this._validateItem(t),i=this._getElement(n),i&&(r=this._renderItem(t),i.replaceWith(r)),t.id},remove:function(n){var t=this._getElement(n);t&&(t.data("d",null),t.children().off(),t.remove())},expand:function(n){var r=this.settings,i=this._getElement(n),t;i&&((o=i.data("d"),o.disabled)||(t=i.find(".mj-expander").first(),t)&&t.hasClass("mj-closed")&&(t.removeClass("mj-closed").addClass("mj-open"),o.open_icon&&t.css("background-image","url('"+o.open_icon+"')"),t=i.find("ul.mj-list").first(),t.slideDown(r.animation_duration)))},collapse:function(n){var f=this.settings,i=this._getElement(n),u,r,t;if(i&&(o=i.data("d"),!o.disabled)){for(u=this.getChildren(n),r=0;r<u.length;r++)this.collapse(u[r].id);(t=i.find(".mj-expander"),t)&&t.hasClass("mj-open")&&(t.removeClass("mj-open").addClass("mj-closed"),this.$el.trigger("collapsed",o),o.closed_icon&&t.css("background-image","url('"+o.closed_icon+"')"),t=i.find("ul.mj-list").first(),t.slideUp(f.animation_duration))}},expandAll:function(){var t=this;n.each(this.$el.find("li.mj-item"),function(i,r){var u=n(r).data("d").id;t.expand(u)})},collapseAll:function(){var t=this;n.each(this.$el.find("li.mj-item"),function(i,r){var u=n(r).data("d").id;t.collapse(u)})},saveState:function(){var i=this,t;this.original_data=[];t=this.toArray();n.each(t,function(n,t){i.original_data.push({checked:t.checked,selected:t.selected})})},hasChanged:function(){for(var t,i,r=this.toArray(),n=0,u=r.length,f=this.original_data.length;n<u&&n<f;n++)if(t=r[n],i=this.original_data[n],t.checked!=i.checked||t.selected!=i.selected)return!0;return!1},close:function(){this._stopListening();this.$el.data(this,"mj-treeview-data",null);this.$el.html("")},scrollTo:function(n,t){var r=this._getElement(n),i;r&&(i=r.position().top,t?this.$el.find(".mj-root").animate({scrollTop:i},300):this.$el.find(".mj-root").scrollTop(i))}};n.fn.mjTreeView=function(i){if(!this.length)return mjcore.mjError("mjTreeView: the html element to attach to '"+this.selector+"' does not exist"),null;if(t[i]){var r=n(this).data("mj-treeview-data");if(r)return r[i].apply(r,Array.prototype.slice.call(arguments,1))}else if(i&&typeof i!="object")mjcore.mjError("mjTreeView: Method '"+i+"' does not exist on mjTreeView");else return this.each(function(){var r=Object.create(t);r.init(i,this);n.data(this,"mj-treeview-data",r)})}})(jQuery)});$(document).ready(function(){(function(t){var i={init:function(n,i){this.el=i;this.$el=t(i);this.close();this.widget_class="mjTreeGrid";this._reset();this._validateData(n);this._render();this._startListening()},_reset:function(){this.start=0;this.tree=null;this.node_map={};this.nodes=[];this.visible_nodes=[];this.idf=null;this.pidf=null;this.drop_placement=null;this.drop_id=null},_validateItem:function(n){var r=t.extend({},{image:null,selected:null,checked:null,disabled:!1,expanded:!1},n),i;t.extend(n,r);n[this.idf]==null&&(n[this.idf]=mjcore.generateId());n[this.pidf]===undefined&&(n[this.pidf]=null);this.settings.show_checkboxes?(i=[{val:0,to:0},{val:!1,to:0},{val:1,to:1},{val:2,to:2}],n.checked=mjcore.validate(n.checked,i,0),n.selected=null):(i=[{val:0,to:!1},{val:!1,to:!1},{val:1,to:!0},{val:!0,to:!0}],n.selected=mjcore.validate(n.selected,i,!1),n.checked=null);i=[{val:0,to:!1},{val:!1,to:!1},{val:1,to:!0},{val:!0,to:!0}];n.disabled=mjcore.validate(n.disabled,i,!1)},_validateData:function(n){var r=this,i,u,f;this.settings=t.extend({},{id_field:"id",parent_id_field:"pid",items:[],show_checkboxes:!1,cellRender:null,animation_duration:0,multi_select:!1,dragdrop:!1,sublist_indent:16,recursive:!0,virtual_mode:!1,page_size:15,filter_function:null,columns:[],wrap_text:!1,show_borders:!0,border_color:"efefef",width:"100%",height:"100%",disabled:!1,theme:null},n);i=this.settings;i.items||(i.items=[]);u=i.items;i.id_field==null&&(mjcore.mjError("mjTreeGrid Error: id_field not defined!!"),i.id_field="id");i.parent_id_field==null&&(mjcore.mjError("mjTreeGrid Error: parent_id_field not defined!!"),i.parent_id_field="pid");this.idf=i.id_field;this.pidf=i.parent_id_field;f={};t.each(u,function(n,t){r._validateItem(t);var i=t[r.idf];f[i]&&mjcore.mjError("mjTreeGrid Error: duplicate id: "+i+" found in data. Ids must be unique.");f[i]=t});t.each(u,function(n,t){var i=t[r.pidf];i==null||f[i]||(mjcore.mjError("mjTreeGrid Error: found reference to non existent id: "+i),t[r.pidf]=null)});this._toTree2(u);this._flattenTree()},_startListening:function(){var n=this;this._stopListening();this.$el.on("click",".mj-expander",function(i){i.preventDefault();i.stopPropagation();var u=t(i.currentTarget),f=u.closest(".mj-row"),r=f.data("d");u.hasClass("mj-open")?(n.collapse(r),n.$el.trigger("collapse",r)):(n.expand(r),n.$el.trigger("expand",r))});this.$el.on("click",".mj-treegrid",function(){n.$el.trigger("emptySpaceClick")});this.$el.find("click",".mj-content").unbind("click");this.$el.on("click",".mj-content",function(i){i.preventDefault();i.stopPropagation();var u=t(i.currentTarget),f=u.closest(".mj-row"),r=f.data("d");if(r){if(r.data.disabled)return;n.settings.show_checkboxes?(r.data.checked==1?n.uncheck(r):n.check(r),n.$el.trigger("checkChange",r)):(n.select(r),n.$el.trigger("selected",r))}});if(this.settings.dragdrop){jQuery.event.props.push("dataTransfer");this.$el.on({dragstart:function(i){var u,r,f;t(this).css("opacity","0.5");u=t(i.currentTarget).data("d");r=u.data[n.idf];n.drop_id=r;f=mjcore.getBrowserName();f!="msie"&&i.dataTransfer.setData("dragdrop-data",r)},dragenter:function(n){n.preventDefault();n.stopPropagation()},dragleave:function(n){n.preventDefault();n.stopPropagation()},dragover:function(i){i.preventDefault();i.stopPropagation();var o=n.node_map[n.drop_id],s=n.getRowElement(o),u=t(i.currentTarget);if(n.$el.find(".mj-cell").removeClass("mj-drag-over"),n.$el.find(".mj-cell .mj-content").removeClass("mj-drag-over-dashed-border-above"),n.$el.find(".mj-cell .mj-content").removeClass("mj-drag-over-dashed-border-below"),t(i.currentTarget).find(".mj-cell").addClass("mj-drag-over"),n.drop_id!=t(i.currentTarget).data("d").data[n.idf]){var r=u.outerHeight(),f=parseInt(i.originalEvent.clientY,10)-parseInt(n.$el.offset().top,10),e=u.offset().top-parseInt(n.$el.offset().top,10);n.drop_placement="drop-into";f<=e+r/4?(t(i.currentTarget).find(".mj-cell .mj-content").addClass("mj-drag-over-dashed-border-above"),n.drop_placement="drop-before"):f>e+r-r/4&&(t(i.currentTarget).find(".mj-cell .mj-content").addClass("mj-drag-over-dashed-border-below"),n.drop_placement="drop-after")}},dragend:function(i){i.preventDefault();i.stopPropagation();n.$el.find(".mj-row .mj-cell").removeClass("mj-drag-over");n.$el.find(".mj-row .mj-cell .mj-content").removeClass("mj-drag-over-dashed-border-above");n.$el.find(".mj-row .mj-cell .mj-content").removeClass("mj-drag-over-dashed-border-below");t(this).css("opacity","1")},drop:function(i){i.preventDefault();i.stopPropagation();var e=n.drop_id,o=n.node_map[e],r=n.settings,u=o,f=t(i.currentTarget).data("d");r.beforeDrop?r.beforeDrop(u,f,n.drop_placement)&&(n._dropIt(i),r.afterDrop&&r.afterDrop(u,f,n.drop_placement)):(n._dropIt(i),r.afterDrop&&r.afterDrop(u,f,n.drop_placement))}},".mj-row")}},_dropIt:function(n){switch(this.drop_placement){case"drop-before":this._dropBefore(n);break;case"drop-after":this._dropAfter(n);break;default:this._dropInto(n)}},_isBadDrag:function(n,t){var r,i,u,f;if(t==n)return!0;for(r=this.getChildren(n),i=0,u=r.length;i<u;i++)if(f=r[i],f==t)return!0;return!1},_removeNodeFromTree:function(n){n.prev&&(n.prev.next=n.next);n.next&&(n.next.prev=n.prev);n.parent&&n.parent.children==n&&(n.parent.children=n.next);this.tree==n&&(this.tree=n.next);n.prev=null;n.next=null},_dropBefore:function(n){var r=this,f=r.drop_id,u=r.node_map[f],i=t(n.currentTarget).data("d");if(!this._isBadDrag(u,i)){this._removeNodeFromTree(u);u.data[r.pidf]=i.data[r.pidf];u.parent=i.parent;u.next=i;u.prev=i.prev;i.prev?i.prev.next=u:i.parent&&i.parent.children==i&&(i.parent.children=u);i.prev=u;r.tree==i&&(r.tree=u);r._buildNodesFromTree();r._flattenTree();r._redraw();r._applyCSS();return}},_dropAfter:function(n){var i=this,f=i.drop_id,r=i.node_map[f],u=t(n.currentTarget).data("d");if(!this._isBadDrag(r,u)){this._removeNodeFromTree(r);r.data[i.pidf]=u.data[i.pidf];r.parent=u.parent;r.prev=u;r.next=u.next;u.next&&(u.next.prev=r);u.next=r;i._buildNodesFromTree();i._flattenTree();i._redraw();i._applyCSS();return}},_dropInto:function(n){var r=this,e=r.drop_id,i=r.node_map[e],u=t(n.currentTarget).data("d"),f;if(!this._isBadDrag(i,u)){this._removeNodeFromTree(i);i.data[this.pidf]=u.data[this.idf];i.parent=u;u.children&&(f=u.children,i.next=f,f.prev=i);u.children=i;r._buildNodesFromTree();r._flattenTree();r._redraw();r._applyCSS();return}},_stopListening:function(){this.$el.off()},_renderRow:function(n){var r=this.settings,u=t("<tr>",{"class":"mj-row"}),e,h,i,s,f,c,o,a,l;if(r.dragdrop&&u.attr("draggable","true"),u.data("d",n),e=t("<td>",{"class":"mj-cell"}),n.children&&(i=t("<div>",{"class":"mj-expander"}),n.data.expanded?i.addClass("mj-open"):i.addClass("mj-closed"),e.append(i)),h=n.parent,n.parent==null||n.data.expanded||h&&h.data.expanded?u.show():u.hide(),i=t("<div>",{"class":"mj-content"}),n.data.disabled&&u.addClass("mj-disabled"),n.data.selected&&!n.data.disabled&&i.addClass("selected"),r.show_checkboxes){s="";switch(n.data.checked){case 1:s=" checked";break;case 2:s=" half-ticked"}i.append("<div class='mj-checkbox-box"+s+"'><div class='mj-tick'><\/div><\/div>")}for(n.data.image&&i.append("<img class='mj-image ' src='"+n.data.image+"' />"),f=r.columns[0],c=r.cellRender?r.cellRender(n,f,0):n.data[f.data_field],r.wrap_text?i.append("<div class='mj-text' title='"+f.data_field+"'>"+c+"<\/div>"):i.append("<div class='mj-text mj-nowrap' title='"+f.data_field+"'>"+c+"<\/div>"),i.data("d",n),e.append(i),u.append(e),o=1,a=r.columns.length;o<a;o++)f=r.columns[o],l="",l=r.cellRender?r.cellRender(n,f,o):n.data[f.data_field],e=t("<td>",{"class":"mj-cell",html:l}),u.append(e);return u},_render:function(){var o=this,f=this.settings,n=t("<div>",{"class":"mj-widget mj-treegrid mj-noselect"}),i=t("<div>",{"class":"mj-treegrid-container"}),e=t("<table>",{"class":"mj-table mj-root"}),r,u;return f.dragdrop&&n.attr("draggable","true"),i.html(e),n.html(i),r=t("<div>",{"class":"mj-vertical-scrollbar-container"}),u=t("<div>",{"class":"mj-horizontal-scrollbar-container"}),n.append(r),n.append(u),this.$el.html(n),this._redraw(),this},_redraw:function(){var i=this.$el.find(".mj-root"),e,r,o,u,n,s,f;if(i.empty(),e=this,r=this.settings,r.virtual_mode)for(o=this.visible_nodes.length,u=0,n=this.start;n<o&&u<r.page_size;n++)s=this.visible_nodes[n],f=this._renderRow(s),i.append(f),f.is(":visible")&&u++;else t.each(this.visible_nodes,function(n,t){var r=e._renderRow(t);i.append(r)});this._applyCSS()},_applyCSS:function(){var i=this,n=this.settings,r=this.$el.find(".mj-row");t.each(r,function(r,u){var f=t(u).data("d"),e=i.getLevel(f),o=e*n.sublist_indent+2;t(u).find(".mj-cell").first().css({"padding-left":o})});t.each(n.columns,function(n,t){var u=i.$el.find(".mj-cell:nth-child("+(n+1)+")"),r={};t.width&&(r.width=t.width,r["max-width"]=t.width);t.align&&(r["text-align"]=t.align);u.css(r)});n.show_borders?this.$el.find(".mj-cell").css({border:"1px solid #"+n.border_color}):this.$el.find(".mj-cell").css({border:"1px solid transparent"})},_createScrollBars:function(){var n=this,u;return},_buildNodesFromTree:function(){var t=this,n;for(this.nodes=[],n=this.tree;n;n=n.next)this.nodes.push(n),this.recurseChildren(n,function(n){t.nodes.push(n)})},_flattenTree:function(){var t=this,n;for(this.visible_nodes=[],n=this.tree;n;n=n.next)n.visible&&(this.visible_nodes.push(n),t.recurseChildren(n,function(n){n.visible&&t.visible_nodes.push(n)}))},_toTree:function(n){function e(u){if(u)for(var f=u;f;f=f.next)r=null,i.nodes.push(f),t.each(n,function(n,t){if(f.data[i.idf]!=null&&f.data[i.idf]==t[i.pidf]){var u=i._createNode(t);i.node_map[t[i.idf]]=u;f.children||(f.children=u);u.parent=f;r&&(r.next=u,u.prev=r);r=u}}),e(f.children)}var i=this,u,r,f;if(this.node_map={},this.nodes=[],u=null,!n||n.length==0)return u;r=null;f=0;t.each(n,function(n,t){if(t[i.pidf]==null){f++;var e=i._createNode(t);i.node_map[t[i.idf]]=e;u||(u=e);r&&(r.next=e,e.prev=r);r=e}});e(u);this.tree=u},_toTree2:function(n){var i=this,r,u;if(this.node_map={},this.nodes=[],this.tree=null,!n||n.length==0)return root;r=null;u=[];t.each(n,function(n,t){var f=i._createNode(t);i.node_map[t[i.idf]]=f;u.push(f);t[i.pidf]==null&&(i.tree||(i.tree=f),r&&(r.next=f,f.prev=r),r=f)});t.each(u,function(n,t){var f=t.data[i.pidf],r,u;i.nodes.push(t);f!=null&&(r=i.node_map[f],r?(t.parent=r,u=i._getLastChildNode(r),u?(u.next=t,t.prev=u):r.children=t):console.log("error: node not found in node map"))})},getLevel:function(n){for(var t=0;n;)n=n.parent,n&&t++;return t},_printTree:function(){for(var t=this,n=this.tree;n;n=n.next)n.visible&&(console.log(n.data),this.recurseChildren(n,function(n){n.visible&&console.log(n.data)}))},_createNode:function(n){return{data:n,parent:null,children:null,next:null,prev:null,visible:!0}},recurseChildren:function(n,t){if(n&&t)for(var i=n.children;i;i=i.next)t(i),i.children&&this.recurseChildren(i,t)},recurseParents:function(n,t){n&&t&&n.parent&&(t(n.parent),this.recurseParents(n.parent,t))},getChildren:function(n){var t=[];return this.recurseChildren(n,function(n){t.push(n)}),t},getSiblings:function(t){var r=this,i=[];if(!t)return i;for(n=t;n;n=n.next)i.push(n);return i},getRows:function(){return this.nodes},getRowElement:function(n){var r,i,f,u;if(!n)return null;for(r=this.$el.find(".mj-row"),i=0,f=r.length;i<f;i++)if(u=r[i],t(u).data("d")==n)return t(u);return null},getRowElementById:function(n){var o=this,r,i,e,u,f;if(n==null)return null;for(r=this.$el.find(".mj-row"),i=0,e=r.length;i<e;i++)if(u=r[i],f=t(u).data("d"),f&&f.data[this.idf]==n)return t(u);return null},getRowById:function(n){return n==null?null:this.node_map[n]},clear:function(){this.settings.items=[];this.start=0;this.tree=null;this.node_map={};this.nodes=[];this.visible_nodes=[];this._redraw()},search:function(n){if(!n)return[];var i=this.$el.find(".mj-row");return i.filter(function(){var i=t(this).data("d");return n(i)})},enableAll:function(){this.$el.find(".mj-row").removeClass("mj-disabled");t.each(this.node_map,function(n,t){t.data.disabled=!1})},disableAll:function(){this.$el.find(".mj-row").addClass("mj-disabled");t.each(this.node_map,function(n,t){t.data.disabled=!0})},enable:function(n){var i=this,t;n&&(n.data.disabled=!1,t=this.getRowElement(n),t&&(t.removeClass("mj-disabled"),i.recurseChildren(n,function(n){n.data.disabled=!1;t=i.getRowElement(n);t&&t.removeClass("mj-disabled")})))},enableById:function(n){if(n!=null){var t=this.node_map[n];this.enable(t)}},enableAt:function(n){if(n!=null&&!(n<0)&&!(n>=this.nodes.length)){var t=this.nodes[n];this.enable(t)}},disable:function(n){var i=this,t;n&&(n.data.disabled=!0,t=this.getRowElement(n),t&&(t.addClass("mj-disabled"),i.recurseChildren(n,function(n){n.data.disabled=!0;t=i.getRowElement(n);t&&t.addClass("mj-disabled")})))},disableById:function(n){if(n!=null){var t=this.node_map[n];this.disable(t)}},disableAt:function(n){if(n!=null&&!(n<0)&&!(n>=this.nodes.length)){var t=this.nodes[n];this.disable(t)}},checkAll:function(){this.settings.show_checkboxes&&(t.each(this.node_map,function(n,t){t.data.checked=1}),this.$el.find(".mj-checkbox-box").addClass("checked").removeClass("half-ticked"))},uncheckAll:function(){this.settings.show_checkboxes&&(t.each(this.node_map,function(n,t){t.data.checked=0}),this.$el.find(".mj-checkbox-box").removeClass("checked").removeClass("half-ticked"))},check:function(n,t){var u=this.settings,r=this,i;n&&u.show_checkboxes&&(i=this.getRowElement(n),n.data.checked=1,i&&i.find(".mj-checkbox-box").addClass("checked").removeClass("half-ticked"),u.recursive&&(r.recurseChildren(n,function(n){n.data.checked=1;i=r.getRowElement(n);i&&i.find(".mj-checkbox-box").addClass("checked").removeClass("half-ticked")}),(t==!0||t==undefined)&&r.recurseParents(n,function(n){n.data.checked=1;i=r.getRowElement(n);i&&i.find(".mj-checkbox-box").addClass("checked").removeClass("half-ticked")})))},checkById:function(n){if(n!=null){var t=this.node_map[n];this.check(t)}},uncheck:function(n){if(n&&this.settings.show_checkboxes){var i=this,t=this.getRowElement(n);t&&t.find(".mj-checkbox-box").removeClass("checked").removeClass("half-ticked");n.data.checked=0;i.recurseChildren(n,function(n){n.data.checked=0;t=i.getRowElement(n);t&&t.find(".mj-checkbox-box").removeClass("checked").removeClass("half-ticked")})}},uncheckById:function(n){if(n!=null){var t=this.node_map[n];this.uncheck(t)}},checkAt:function(n){n==null||n<0||n>=this.nodes.length||this.check(this.nodes[n])},uncheckAt:function(n){n==null||n<0||n>=this.nodes.length||this.uncheck(this.nodes[n])},getChecked:function(){var n=[];return t.each(this.nodes,function(t,i){i.data.checked==1&&n.push(i)}),n},halfTick:function(n){if(n&&this.settings.show_checkboxes){this.uncheck(n);n.data.checked=2;var t=this.getRowElement(n);t&&t.find(".mj-checkbox-box").removeClass("checked").addClass("half-ticked")}},halfTickById:function(n){if(n!=null){var t=this.node_map[n];t&&this.halfTick(t)}},halfTickAt:function(n){n==null||n<0||n>=this.nodes.length||this.halfTick(this.nodes[n])},halfTickAll:function(){this.settings.show_checkboxes&&(t.each(this.node_map,function(n,t){t.data.checked=2}),this.$el.find(".mj-checkbox-box").removeClass("checked").addClass("half-ticked"))},deselectHalfTicked:function(){this.settings.show_checkboxes&&(t.each(this.node_map,function(n,t){t.data.checked==2&&(t.data.checked=0)}),this.$el.find(".mj-checkbox-box.half-ticked").removeClass("half-ticked"))},select:function(n,t){var i=this.settings;n&&!i.show_checkboxes&&(i.multi_select||this.deselectAll(),n.data.selected=!0,t||(t=this.getRowElement(n)),t.find(".mj-content").addClass("selected"))},selectById:function(n){if(n!=null){var t=this.node_map[n];this.select(t)}},deselect:function(n,t){var i=this.settings;n&&!i.show_checkboxes&&(n.data.selected=!1,t||(t=this.getRowElement(n)),t.find(".mj-content").removeClass("selected"))},deselectById:function(n){if(n!=null){var t=this.node_map[n];this.deselect(t)}},getSelected:function(){var n=[];return this.settings.show_checkboxes?n:(t.each(this.nodes,function(t,i){i.data.selected&&n.push(i)}),n)},selectAll:function(){this.settings.show_checkboxes||(t.each(this.node_map,function(n,t){t.data.selected=!0}),this.$el.find(".mj-content").addClass("selected"))},deselectAll:function(){this.settings.show_checkboxes||(t.each(this.node_map,function(n,t){t.data.selected=!1}),this.$el.find(".mj-content").removeClass("selected"))},selectAt:function(n){n==null||n<0||n>=this.nodes.length||this.select(this.nodes[n])},deselectAt:function(n){n==null||n<0||n>=this.nodes.length||this.deselect(this.nodes[n])},sort:function(n){function f(n,t){if(t)n.sort(function(n,i){return t(n,i)});else{var r=i.settings.columns[0].data_field;n.sort(function(n,t){return n[r].toLowerCase()>t[r].toLowerCase()?1:n[r].toLowerCase()<t[r].toLowerCase()?-1:0})}}var i=this,r=[],u=[];t.each(this.nodes,function(n,t){r.push(t.data);u.push({id:t.data[i.idf],visible:t.visible})});f(r,n);this._toTree2(r);t.each(u,function(n,t){i.node_map[t.id].visible=t.visible});this._flattenTree();this._redraw()},filter:function(n,i){var r=this,u=this.settings;if(n&&n!=""&&(u.filter||i)){function f(n,t){for(var e=t;e;e=e.next)e.visible=i?i(e.data,n):u.filter(e.data,n),e.visible?(r.recurseParents(e,function(n){n.visible=!0}),r.recurseChildren(e,function(n){n.visible=!0})):e.children&&f(n,e.children);return null}f(n,this.tree)}else t.each(this.nodes,function(n,t){t.visible=!0});this._flattenTree();this._redraw()},insertRow:function(n,t){var o,i,r,u,f,e;n!=null&&t!=null&&(o=this.settings,this._validateItem(t),t[this.pidf]=n.data[this.pidf],o.show_checkboxes||o.multi_select||!t.selected||this.deselectAll(),i=this._createNode(t),this.node_map[t[this.idf]]=i,r=this.nodes.indexOf(n),r>-1&&this.nodes.splice(r,0,i),n.prev&&(n.prev.next=i,i.prev=n.prev),i.next=n,i.parent=n.parent,n.parent?(n.parent.children==n&&(n.parent.children=i),n.parent.visible&&(r=this.visible_nodes.indexOf(n),r>-1&&this.visible_nodes.splice(r,0,i),u=this.getRowElement(n),u&&(f=this._renderRow(i),u.before(f),e=this.getRowElement(n.parent),e&&!e.is(":visible")&&f.hide(),this._applyCSS()))):(r=this.visible_nodes.indexOf(n),r>-1&&this.visible_nodes.splice(r,0,i),u=this.getRowElement(n),u&&(f=this._renderRow(i),u.before(f),e=this.getRowElement(n.parent),e&&!e.is(":visible")&&f.hide(),this._applyCSS())))},insertRowById:function(n,t){var i=this.node_map[n];this.insertRow(i,t)},_getLastRootNode:function(){var n=null;return t.each(this.nodes,function(t,i){i.parent||(n=i)}),n},_getLastChildNode:function(n){var i,t;if(!n)return null;for(i=null,t=n.children;t;t=t.next)i=t;return i},addRow:function(n,t){var s,o,i,r,u,f,e;if(n!=null&&t!=null){if(s=this._getLastRootNode(),n==s){this.addRootNode(t);return}o=this.settings;this._validateItem(t);o.show_checkboxes||o.multi_select||!t.selected||this.deselectAll();i=this._createNode(t);this.node_map[t[this.idf]]=i;n.next?(r=this.nodes.indexOf(n.next),r>-1&&this.nodes.splice(r,0,i),(!n.parent||n.parent&&n.parent.visible)&&(r=this.visible_nodes.indexOf(n.next),r>-1&&(this.visible_nodes.splice(r,0,i),u=this.getRowElement(n.next),u&&(i.prev=n,i.next=n.next,i.parent=n.parent,n.next=i,f=this._renderRow(i),u.before(f),e=this.getRowElement(n.parent),e&&!e.is(":visible")&&f.hide(),this._applyCSS())))):(r=this.nodes.indexOf(n),r>-1&&this.nodes.splice(r+1,0,i),(!n.parent||n.parent&&n.parent.visible)&&(r=this.visible_nodes.indexOf(n),r>-1&&(this.visible_nodes.splice(r+1,0,i),u=this.getRowElement(n),u&&(i.prev=n,i.next=n.next,i.parent=n.parent,n.next=i,f=this._renderRow(i),u.after(f),e=this.getRowElement(n.parent),e&&!e.is(":visible")&&f.hide(),this._applyCSS()))))}},addRowById:function(n,t){var i=this.node_map[n];this.addRow(i,t)},addRootNode:function(n){var r,t,i,u,f;n!=null&&(r=this.settings,this._validateItem(n),r.show_checkboxes||r.multi_select||!n.selected||this.deselectAll(),n[this.pidf]=null,t=this._createNode(n),this.node_map[n[this.idf]]=t,i=this._getLastRootNode(),i?(i.next=t,t.prev=i):this.tree=t,this.nodes.push(t),this.visible_nodes.push(t),u=this._renderRow(t),f=this.$el.find(".mj-root"),f.append(u))},addChild:function(n,t){var e=this.settings,i,r,u,o,f;n&&t&&(this._validateItem(t),e.show_checkboxes||e.multi_select||!t.selected||this.deselectAll(),i=this._createNode(t),this.node_map[t[this.idf]]=i,t[this.pidf]=n.data[this.idf],i.parent=n,n.children&&(i.next=n.children),n.children=i,r=this.nodes.indexOf(n),r>-1&&this.nodes.splice(r+1,0,i),n.visible&&(r=this.visible_nodes.indexOf(n),r>-1&&this.visible_nodes.splice(r+1,0,i),u=this.getRowElement(n),u&&(o=u.is(":visible"),f=this._renderRow(i),u.after(f),o||f.hide(),f=this._renderRow(n),u.replaceWith(f),this._applyCSS())))},addChildById:function(n,t){var i=this.node_map[n];this.addChild(i,t)},updateRow:function(n,t){var r,i,u,f;n!=null&&t!=null&&(r=this.settings,this._validateItem(t),r.show_checkboxes||r.multi_select||!t.selected||this.deselectAll(),t[this.idf]=n.data[this.idf],t[this.pidf]=n.data[this.pidf],t.expanded=n.data.expanded,n.data=t,n.visible&&(i=this.getRowElement(n),i&&(u=i.is(":visible"),f=this._renderRow(n),i.replaceWith(f),u||i.hide(),this._applyCSS())))},updateRowById:function(n,t){var i=this.node_map[n];this.updateRow(i,t)},removeRow:function(n){var r=this,u,i,f;n&&(delete this.node_map[n.data[r.idf]],u=mjcore.findIndex(this.nodes,function(t){return n==t}),u>-1&&this.nodes.splice(u,1),u=mjcore.findIndex(this.visible_nodes,function(t){return n==t}),u>-1&&this.visible_nodes.splice(u,1),i=this.getRowElement(n),i&&(i.data("d",null),i.children().off(),i.remove()),f=[],this.recurseChildren(n,function(n){f.push(n)}),t.each(f,function(n,t){delete r.node_map[t.data[r.idf]];n=mjcore.findIndex(r.nodes,function(n){return t==n});n>-1&&r.nodes.splice(n,1);n=mjcore.findIndex(r.visible_nodes,function(n){return t==n});n>-1&&r.visible_nodes.splice(n,1);i=r.getRowElement(t);i&&(i.data("d",null),i.children().off(),i.remove())}),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),n.parent&&n.parent.children==n&&(n.parent.children=n.next),this._applyCSS())},removeRowById:function(n){var t=this.node_map[n];this.removeRow(t)},expand:function(n){var u=this,r,t,i;if(n&&n.children&&(n.data.expanded=!0,i=this.getRowElement(n),i)&&(r=i.find(".mj-expander"),r)){for(t=n.children;t;t=t.next)i=this.getRowElement(t),i&&i.show(),t.data.expanded&&this.expand(t);r.removeClass("mj-closed").addClass("mj-open")}},expandById:function(n){if(n==null)return null;var t=this.node_map[n];this.expand(t)},collapse:function(n){var r=this,t,i;n&&(n.data.expanded=!1,t=this.getRowElement(n),t)&&(i=t.find(".mj-expander"),i)&&(this.recurseChildren(n,function(n){var t=r.getRowElement(n);t&&t.hide()}),i.removeClass("mj-open").addClass("mj-closed"))},collapseById:function(n){if(n==null)return null;var t=this.node_map[n];this.collapse(t)},expandAll:function(){var n=this;t.each(this.node_map,function(t,i){i.children&&n.expand(i)})},collapseAll:function(){var n=this;t.each(this.node_map,function(t,i){i.children&&n.collapse(i)})},getExpanded:function(){var n=[];return t.each(this.nodes,function(t,i){i.data.expanded&&n.push(i)}),n},close:function(){this._stopListening();this.$el.data(this,"mj-treegrid-data",null);this.$el.html("")},scrollTo:function(n,t){var i,r;n&&(i=this.getRowElement(n),i&&(r=i.position().top,t?this.$el.find(".mj-treegrid").animate({scrollTop:r},300):this.$el.find(".mj-treegrid").scrollTop(r)))},scrollToById:function(n){if(n==null)return null;var t=this.node_map[n];this.scrollTo(t)}};t.fn.mjTreeGrid=function(n){if(!this.length)return mjcore.mjError("mjTreeGrid: the html element to attach to '"+this.selector+"' does not exist"),null;if(i[n]){var r=t(this).data("mj-treegrid-data");if(r)return r[n].apply(r,Array.prototype.slice.call(arguments,1))}else if(n&&typeof n!="object")mjcore.mjError("Method '"+n+"' does not exist on mjTreeGrid");else return this.each(function(){var r=Object.create(i);r.init(n,this);t.data(this,"mj-treegrid-data",r)})}})(jQuery)});$(document).ready(function(){(function(n){var t={_init:function(t,i){return this.widget_class="mjRadioButton",this.el=i,this.$el=n(i),this._validateData(t),this.close(),this._render(),this._startListening(),this},_render:function(){var r,t,u,i;return this.settings.original_value=this.settings.checked,r="mj-radiobutton mj-widget",this.settings.disabled&&(r+=" mj-disabled"),t=n("<div>",{"class":r}),t.data("data",this.settings),u=this.settings.checked==1?" checked":"",i="<div class='mj-radio"+u+"'><div class='mj-dot'><\/div><\/div>",this.settings.image&&(i+="<img class='mj-image ' src='"+this.settings.image+"' />"),i+="<div class='mj-text '>"+this.settings.text+"<\/div>",t.html(i),this.$el.html(t),this},_startListening:function(){var t=this;this._stopListening();this.$el.on("click",".mj-radiobutton",function(i){i.preventDefault();var r=n(i.currentTarget).data("data");r.disabled||(r.checked==1?(t.$el.find(".mj-radio").removeClass("checked"),r.checked=0):(t.$el.find(".mj-radio").addClass("checked"),r.checked=1),t.$el.trigger("checkChange",r))})},_stopListening:function(){this.$el.off()},_validateData:function(t){var i;this.settings=n.extend({},{id:1,text:"select",checked:0,image:null,data:null,original_value:0,width:"auto",height:"auto",disabled:!1,theme:null},t);i=this.settings;(i.checked==undefined||i.checked==null||i.checked==!1||i.checked=="false"||i.checked=="0")&&(i.checked=0);(i.checked=="1"||i.checked==!0||i.checked=="true")&&(i.checked=1);mjcore.isEmpty(i.text)&&(i.text="");mjcore.isEmpty(i.id)&&(i.id=i.text);(i.disabled==undefined||i.disabled==null||i.disabled==!1)&&(i.disabled=0);(i.disabled=="1"||i.disabled==!0)&&(i.disabled=1)},hasChanged:function(){return this.settings.checked!=this.settings.original_value},check:function(){this.$el.find(".mj-radio").addClass("checked").removeClass("half-ticked");this.settings.checked=1},uncheck:function(){this.$el.find(".mj-radio").removeClass("checked").removeClass("half-ticked");this.settings.checked=0},set:function(n){switch(n){case 0:this.uncheck();break;case 1:this.check()}},enable:function(){this.$el.find(".mj-radiobutton").removeClass("mj-disabled");this.settings.disabled=!1},disable:function(){this.$el.find(".mj-radiobutton").addClass("mj-disabled");this.settings.disabled=!0},val:function(){return this.settings},close:function(){this._stopListening();n.removeData(this.el,"mj-radiobutton-data");this.$el.html("")}};n.fn.mjRadioButton=function(i){if(!this.length)return mjcore.mjError("mjRadioButton the html element to attach to '"+this.selector+"' does not exist"),null;if(t[i]){var r=n(this).data("mj-radiobutton-data");if(r)return r[i].apply(r,Array.prototype.slice.call(arguments,1))}else if(typeof i!="object"&&i)mjcore.mjError("Method '"+i+"' does not exist on mjRadioButton");else return this.each(function(r,u){var u=Object.create(t);u._init(i,this);n.data(this,"mj-radiobutton-data",u)})}})(jQuery)});$(document).ready(function(){(function(n){var t={init:function(t,i){this.widget_class="mjSearchBox";this.el=i;this.$el=n(i);this.close();this._validateData(t);this._render();this._startListening()},_validateData:function(t){this.settings=n.extend({},{value:"",placeholder:"",width:"100%",height:"100%",disabled:!1,theme:null},t)},_startListening:function(){var t=this;this._stopListening();this.$el.on("keyup","input",function(i){i.preventDefault();var r=n(i.currentTarget).val();t.$el.trigger("mjKeyup",r)});this.$el.on("click",".mj-search-btn",function(n){n.preventDefault();var i=t.$el.find("input").val();t.$el.trigger("search",i)})},_stopListening:function(){this.$el.off()},_render:function(){var t=this,n="<div class='mj-widget mj-searchbox '>";return n+=" <div class='mj-searchbox-container'>",n+="  <input class='mj-input' value='"+this.settings.value+"' placeholder='"+this.settings.placeholder+"' />",n+=" <\/div>",n+=" <div class='mj-search-btn'><\/div>",n+="<\/div>",this.$el.html(n),this},clear:function(){var n=this.$el.find("input").val("")},close:function(){this._stopListening();this.$el.data(this,"mj-searchbox-data",null);this.$el.html("")}};n.fn.mjSearchBox=function(i){if(!this.length)return mjcore.mjError("mjSearchBox: the html element to attach to '"+this.selector+"' does not exist"),null;if(t[i]){var r=n(this).data("mj-searchbox-data");if(r)return r[i].apply(r,Array.prototype.slice.call(arguments,1))}else if(i&&typeof i!="object")mjcore.mjError("Method '"+i+"' does not exist on mjSearchBox");else return this.each(function(){var r=Object.create(t);r.init(i,this);n.data(this,"mj-searchbox-data",r)})}})(jQuery)});$(document).ready(function(){(function(n){var t={_init:function(t,i){return this.widget_class="mjScrollBar",this.state={range:0,prev_pos:0,thumb_size:0,track_element:null,maxscroll:0,viewport_size:0,content_size:0,scrolling:0,mousestart:0,start_pos:0,has_touch_events:!1},this.el=i,this.$el=n(i),this._validateData(t),this.close(),this._render(),this._startListening(),this},_validateData:function(t){var u={orientation:"vertical",min:0,max:1e3,value:0,step_size:1,show_buttons:!0,integer_values:!0,page_size:null,width:20,height:20,disabled:!1,theme:null},i,r,f,e;this.settings=n.extend({},u,t);i=this.settings;r=this.state;i.orientation=mjcore.validateString(i.orientation,["vertical","horizontal"],"vertical");i.min=mjcore.validateFloat(i.min,0);i.max=mjcore.validateFloat(i.max,1e3);i.value=mjcore.validateFloat(i.value,i.min);i.min>i.max&&(f=i.min,i.min=i.max,i.max=f);i.value<i.min&&(i.value=i.min);i.value>i.max&&(i.value=i.max);i.step_size=mjcore.validateFloat(i.step_size,1);i.show_buttons=mjcore.validateBool(i.show_buttons,!0);i.integer_values=mjcore.validateBool(i.integer_values,!0);i.page_size=mjcore.validateInt(i.page_size,null,null);i.disabled=mjcore.validateBool(i.disabled,!1);r.range=i.max-i.min;i.page_size>r.range&&(i.page_size=r.range);i.step_size>r.range&&(i.step_size=r.range);e=9007199254740992;r.prev_pos=e;i.width=mjcore.validateInt(i.width,null,u.width);i.height=mjcore.validateInt(i.height,null,u.height)},_calcThumbSize:function(){var t=this.settings,n=this.state,i,r;i=.1;t.page_size&&t.range>n.page_size&&(i=t.page_size/n.range);n.thumb_size=t.orientation=="vertical"?n.track_element.height()*i:n.track_element.width()*i;r=5;n.thumb_size<r&&(n.thumb_size=r);t.orientation=="vertical"?n.track_element.height()-n.thumb_size<=0?(n.thumb_size=0,n.thumb_element.hide()):n.thumb_element.show():n.track_element.width()-n.thumb_size<=0?(n.thumb_size=0,n.thumb_element.hide()):n.thumb_element.show()},_calcMaxScroll:function(){var t=this.settings,n=this.state;this._calcThumbSize();n.thumb_size==0?n.maxscroll=t.max:t.orientation=="vertical"?(n.maxscroll=n.track_element.height()-n.thumb_size,n.thumb_element.height(n.thumb_size)):(n.maxscroll=n.track_element.width()-n.thumb_size,n.thumb_element.width(n.thumb_size))},_render:function(){var t=this.settings,i=this.state,r="mj-vertical",n;t.orientation=="horizontal"&&(r="mj-horizontal");n="<div class='mj-widget mj-scrollbar "+r+"'>";n+="<div class='mj-scrollbar-slider'>";t.show_buttons&&(n+=t.orientation=="vertical"?"  <div class='mj-arrow mj-arrow-up'><\/div>":"  <div class='mj-arrow mj-arrow-left'><\/div>");n+=" <div class='mj-scrollbar-track'>";n+="  <div class='mj-scrollbar-thumb'><\/div>";n+=" <\/div>";t.show_buttons&&(n+=t.orientation=="vertical"?"  <div class='mj-arrow mj-arrow-down'><\/div>":"  <div class='mj-arrow mj-arrow-right'><\/div>");n+="<\/div>";n+="<\/div>";this.$el.html(n);this._applyCSS();t.show_buttons||(t.orientation=="vertical"?this.$el.find(".mj-scrollbar-track").css({top:0,bottom:0}):this.$el.find(".mj-scrollbar-track").css({left:0,right:0}));i.thumb_element=this.$el.find(".mj-scrollbar-thumb");i.track_element=this.$el.find(".mj-scrollbar-track");this.set(t.value)},_stopListening:function(){this.$el.off()},_startListening:function(){var t=this,i=this.settings,r=this.state;this.scrolling=!1;this.mousestart=0;this.maxscroll=0;this.start_pos=0;this.has_touch_events="ontouchstart"in document.documentElement;this.$el.on("mousedown",".mj-scrollbar-thumb",function(i){i.preventDefault();i.stopPropagation();t._dragstart(i);n(document).bind("mousemove",t,t._drag);n(document).bind("mouseup",t,t._dragend)});this.$el.on("mousedown",".mj-scrollbar-track",function(n){var f,r,e,u,o,s,h,c;n.preventDefault();f=t.state;r=f.range*.1;i.page_size&&(r=i.page_size);e=f.thumb_element.offset();u=t.$el.offset();i.orientation=="vertical"?(o=e.top-u.top,s=n.pageY-u.top,o<s?t.set(i.value+r,!0):t.set(i.value-r,!0)):(h=e.left-u.left,c=n.pageX-u.left,h<c?t.set(i.value+r,!0):t.set(i.value-r,!0))});this.$el.on("click",".mj-arrow",function(r){r.preventDefault();var u=i.value;i.orientation=="vertical"?n(r.currentTarget).hasClass("mj-arrow-down")?t.set(u+i.step_size,!0):t.set(u-i.step_size,!0):n(r.currentTarget).hasClass("mj-arrow-right")?t.set(u+i.step_size,!0):t.set(u-i.step_size,!0)});n(document).on("mouseleave",function(n){n.data=t;t._dragend(n);r.scrolling=!1})},_applyCSS:function(){var u=this,i=this.settings,n=i.width,t=i.height,r;i.orientation=="vertical"?(this.$el.find(".mj-scrollbar").css({width:n}),this.$el.find(".mj-scrollbar-slider").css({width:n}),this.$el.find(".mj-scrollbar-track").css({top:n,bottom:n+2,width:n-2}),this.$el.find(".mj-arrow").css({width:n,height:n-2})):(this.$el.find(".mj-scrollbar").css({height:t}),this.$el.find(".mj-scrollbar-slider").css({height:t}),this.$el.find(".mj-scrollbar-track").css({left:t,right:t+2,height:t-2}),this.$el.find(".mj-arrow").css({width:t-2,height:t}));r=this.$el.find(".mj-scrollbar-thumb");r.css({width:n-4,height:t-4})},_dragstart:function(n){var r=this.settings,t=this.state,i,u;t.scrolling=!0;i=t.thumb_element.position();t.thumb_element.addClass("mj-scrollbar-thumb-drag");this._calcMaxScroll();r.orientation=="vertical"?(t.start_pos=i.top,t.mousestart=n.pageY):(t.start_pos=i.left,t.mousestart=n.pageX);u=r.value;this.$el.trigger("scrollStart",u)},_drag:function(n){var i;n.preventDefault();var r=n.data,u=r.settings,t=r.state;t.scrolling&&(i=0,i=u.orientation=="vertical"?n.pageY-t.mousestart:n.pageX-t.mousestart,i!=0)&&r._move(t.start_pos+i,!0)},_dragend:function(t){var u;t.preventDefault();var i=t.data,f=i.settings,r=i.state;r.scrolling&&(r.scrolling=!1,r.thumb_element.removeClass("mj-scrollbar-thumb-drag"),n(document).unbind("mousemove",i,i._drag),n(document).unbind("mouseup",i,i._dragend),u=f.value,i.$el.trigger("scrollEnd",u))},_move:function(n,t){var r=this.settings,i=this.state,f,u;(n<=0?n=0:n>=i.maxscroll&&(n=i.maxscroll),n!=i.prev_pos)&&(i.prev_pos=n,r.orientation=="vertical"?i.thumb_element.css({top:n}):i.thumb_element.css({left:n}),f=n/i.maxscroll,r.value=r.min+f*i.range,u=r.value,t&&(r.integer_values?this.$el.trigger("valueChanged",parseInt(u,10)):this.$el.trigger("valueChanged",u)))},set:function(n,t){var i=this.settings,r=this.state,u;n<i.min?n=i.min:n>i.max&&(n=i.max);this._calcMaxScroll();u=(n-i.min)/r.range*r.maxscroll;this._move(u,t)},get:function(){var n=this.settings,t=n.value;return n.integer_values&&(t=parseInt(t,10)),{orientation:n.orientation,min:n.min,max:n.max,value:t,step_size:n.step_size,show_buttons:n.show_buttons,style:n.style,integer_values:n.integer_values,page_size:n.page_size}},setMinMax:function(n,t){var i=this.settings,u=this.state,r;i.min=mjcore.validateFloat(n,0);i.max=mjcore.validateFloat(t,1e3);i.min>i.max&&(r=i.min,i.min=i.max,i.max=r);i.value<i.min&&(i.value=i.min);i.value>i.max&&(i.value=i.max);u.range=t-n;this._calcMaxScroll();this.set(i.value)},close:function(){this._stopListening();n.removeData(this.el,"mj-scrollbar-data");var t=this.$el.find(".mj-scrollbar");t&&t.length>0&&t.remove()}};n.fn.mjScrollBar=function(i){if(!this.length)return mjcore.mjError("mjScrollBar: the html element to attach to '"+this.selector+"' does not exist."),null;if(t[i]){var r=n(this).data("mj-scrollbar-data");return r?r[i].apply(r,Array.prototype.slice.call(arguments,1)):null}if(i&&typeof i!="object")mjcore.mjError("Method '"+i+"' does not exist in mjScrollBar");else return this.each(function(r,u){var f=Object.create(t);f._init(i,u);n.data(u,"mj-scrollbar-data",f)})}})(jQuery)});$(document).ready(function(){(function(n){var t={init:function(t,i){return this.widget_class="mjSuperGrid",this.start=0,this.scrolling=!1,this.sort_column_index=null,this.sort_column_direction=!1,this.el=i,this.$el=n(i),this._validateData(t),this.close(),this._render(),this._startListening(),this},_validateData:function(t){var i,r,f,u;this.settings=n.extend({},{data:[],colheader_rowno:0,rowheader_colno:0,rowheader_type:"column",page_size:0,cellRender:null,columnHeaderCellRender:null,rowHeaderCellRender:null,virtual_mode:!0,width:"auto",height:"auto",disabled:!1,theme:null},t);i=this.settings;i.data instanceof Array||(i.data=[]);i.colheader_rowno=mjcore.validateInt(i.colheader_rowno,null,0);i.rowheader_colno=mjcore.validateInt(i.rowheader_colno,null,0);i.rowheader_type=mjcore.validateString(i.rowheader_type,["column","indent"],"column");i.page_size=mjcore.validateInt(i.page_size,null,0);i.virtual_mode=mjcore.validateBool(i.virtual_mode,!0);i.virtual_mode=!0;i.virtual_mode&&(!i.page_size||i.page_size<=0)&&(r=this.$el.height(),r&&r!=0||(r=240),f=24,i.page_size=Math.floor(r/f-i.colheader_rowno)-1);u=i.data;u&&u.length>0&&i.colheader_rowno>u.length&&(i.colheader_rowno=u.length);i.rowheader_type=="indent"&&(i.rowheader_colno=1)},_startListening:function(){var t=this,i=t.settings,r;this.$el.find(".mj-data-table tr:last-child th").on("click",function(r){var u=n(r.currentTarget).index(),e,f;u+=i.rowheader_colno;t.sort_column_direction=t.sort_column_index==u?!t.sort_column_direction:!0;t.sort_column_index=u;e=i.data.slice(0,i.colheader_rowno);f=i.data.slice(i.colheader_rowno);f.sort(function(n,i){var r=parseFloat(n[u]),f=parseFloat(i[u]);if(isNaN(r)&&(r=n[u]),isNaN(f)&&(f=i[u]),t.sort_column_direction){if(r<f)return 1;if(r>f)return-1}else{if(r<f)return-1;if(r>f)return 1}return 0});i.data=e.concat(f);t._render();t._startListening()});if(this.$el.find(".mj-data-table th").hover(function(t){n(t.currentTarget).find(".mj-arrow").show()},function(r){var u=n(r.currentTarget).index();u+=i.rowheader_colno;t.sort_column_index!=u&&n(r.currentTarget).find(".mj-arrow").hide()}),mjcore.isTouchScreen()){r=this.$el.find(".mj-super-grid-table-container");r.on("touchstart",this,this._touchstart);r.on("touchmove",this,this._touchmove);r.on("touchend",this,this._touchend)}else this.$el.on("mousewheel DOMMouseScroll wheel",".mj-data-table tr",function(n){n.preventDefault();var r=t.start;n.originalEvent.wheelDelta>0?r--:r++;r>=0&&r<i.data.length-t.settings.page_size&&(t.start=r,t.$el.find(".mj-vertical-scrollbar-container").mjScrollBar("set",t.start),t._renderRowHeaderTable(),t._renderDataTable(),t.$el.trigger("mjScrollChange",null))})},_stopListening:function(){this.$el.off()},_touchstart:function(n){var r=n.data,t,i;n.preventDefault();t=n.originalEvent;i=0;i=t.touches?t.touches[0].pageY:t.pageY;r.touch_y=i;r.touch_busy=!1},_touchmove:function(n){var t=n.data,r=n.originalEvent,i=0,f,h;if((i=r.touches?r.touches[0].pageY:r.pageY,i!=t.touch_y)&&!t.touch_busy){var u=t.settings,e=t.$el.find(".mj-super-grid-table-container").height(),o=i-t.touch_y,s=o/e;(t.touch_y=i,f=u.data.length,h=u.colheader_rowno,i=t.start+Math.floor((f-u.page_size)*s),i<0||i>=f)||(t.touch_busy=!0,t.start=i,t._renderRowHeaderTable(),t._renderDataTable(),t.touch_busy=!1)}},_touchend:function(n){var t=n.data;t.touch_busy=!1},_render:function(){var n="<div class='mj-widget mj-super-grid'>",t;return n+="<div class='mj-super-grid-table-container'>",n+="<table class='mj-super-grid-table'>",n+="<tr>",n+="<td class='mj-row-header-table-container'><\/td>",n+="<td class='mj-data-table-container'><\/td>",n+="<\/tr>",n+="<\/table>",n+="<\/div>",n+="<div class='mj-vertical-scrollbar-container'><\/div>",n+="<div class='mj-horizontal-scrollbar-container'><\/div>  ",n+="<\/div>",this.$el.html(n),this._renderRowHeaderTable(),this._renderDataTable(),t=this.settings,mjcore.isEmpty(t.width)||t.width=="auto"||this.$el.find(".mj-widget").css("width",t.width),mjcore.isEmpty(t.height)||t.height=="auto"||this.$el.find(".mj-widget").css("height",t.height),this._createScrollBars(),this.$el.trigger("mjScrollChange",null),this},postRender:function(){var n=this.$el.find(".mj-data-table").height();this.$el.find(".mj-row-header-table").height(n)},_renderColHeaders:function(){var o=this.settings,e=o.data,s=o.rowheader_colno,h=o.colheader_rowno,t,c,u,f,i,l,n,r;if(e.length==0||h==0)return"";for(t="",c=e[0].length,u=0;u<h&&u<e.length;u++){if(f=e[u],t+="<tr>",u==h-1)for(i=s;i<c;i++)n=f[i],n==undefined&&(n="&nbsp;"),l="mj-arrow-down",this.sort_column_index==i&&(l=this.sort_column_direction?"mj-arrow-up":"mj-arrow-down"),t+="<th title='"+n+"'><div class='mj-value'>"+n+"<\/div><div class='mj-arrow "+l+"'><\/div><\/th>";else{for(n=f[s],r=1,t+="<th title='"+n+"' ",i=s+1;i<c;i++)f[i]!=n?(i!=0&&(t+=r>1?" colspan='"+r+"'>":">",t+=n==undefined?"&nbsp;":n,t+="<\/th>"),r=1,n=f[i],t+="<th title='"+n+"' "):r++;t+=r>1?" colspan='"+r+"'>":">";t+=n==undefined?"&nbsp;":n;t+="<\/th>"}t+="<\/tr>"}return t},_renderRow:function(n){var i=this.settings,e=i.data,t,u;r=e[n];var o=i.rowheader_colno,s=r.length,f="<tr>";for(t=o;t<s;t++)u=mjcore.isEmpty(r[t])?"&nbsp;":r[t],i.cellRender&&(u=i.cellRender(u,n,t)),f+="<td>"+u+"<\/td>";return f+"<\/tr>"},_renderRows:function(){var n=this.settings,r=n.data,e=n.rowheader_colno,u=n.colheader_rowno,i="",f,t;if(r.length==0)return i;for(f=Math.min(this.start+u+n.page_size,r.length),t=this.start+u;t<f;t++)i+=this._renderRow(t);return i},_renderRowHeaderTable:function(){var e=this.settings,f=e.data,o=e.rowheader_colno,l=e.colheader_rowno,y=e.page_size,t,i,a,r,v,n,c,s,h,u;if(f.length==0||o==0)return"";if(t="<table class='mj-row-header-table'>",e.rowheader_type=="column"){for(t+="<thead>",i=0;i<l;i++){for(t+="<tr>",n=0;n<o;n++)t+="<th>&nbsp;<\/th>";t+="<\/tr>"}for(t+="<\/thead>",t+="<tbody>",a=Math.min(parseInt(this.start+l+y,10),f.length),r=new Array(o),i=0;i<o;i++)r[i]=1;for(v=parseInt(this.start+l,10),i=v;i<a;i++){for(t+="<tr>",n=0;n<o;n++){if(c=!1,r[n]<=1){for(s=f[i][n],mjcore.isEmpty(s)&&(s="rubbish-text-not-likley-to-appear-in-user-data"),h=i+1;h<a;h++)if(f[h][n]==s)s=f[h][n],r[n]++;else break;r[n]>1&&(c=!0)}u=f[i][n];(mjcore.isEmpty(u)||u=="")&&(u="&nbsp;");c?(t+="<td rowspan='"+r[n]+"' title='"+u+"'>"+u+"<\/td>",c=!1,r[n]++):r[n]==1&&(t+="<td title='"+u+"'>"+u+"<\/td>");r[n]>1&&r[n]--}t+="<\/tr>"}t+="<\/tbody>"}t+="<\/table>";this.$el.find(".mj-row-header-table-container").html(t)},_renderDataTable:function(){var n="<table class='mj-data-table'>";n+="<thead>";n+=this._renderColHeaders();n+="<\/thead>";n+="<tbody>";n+=this._renderRows();n+="<\/tbody>";n+="<\/table>";this.$el.find(".mj-data-table-container").html(n)},_createScrollBars:function(){var t=this,i,r,o,n;if(!mjcore.isTouchScreen()&&(i=this.settings,r=i.data.length,r!=0)){var f=parseInt(i.page_size,10),l=!1,e=!1;r>f&&(o=parseInt(r-f-i.colheader_rowno,10),o>0&&(l=!0));var s=this.$el.find(".mj-super-grid-table").width(),a=this.$el.find(".mj-super-grid-table").height(),h=this.$el.find(".mj-super-grid-table-container").width(),v=this.$el.find(".mj-super-grid-table-container").height(),c=this.$el.find(".mj-super-grid-row-header-table").width(),u=s-h-c;if(u>0&&(e=!0),l){n=this.$el.find(".mj-vertical-scrollbar-container");e&&n.css({bottom:mjcore.MJ_HORIZONTAL_SCROLLBAR_HEIGHT+"px"});n.mjScrollBar({min:0,max:o,page_size:f});n.on("valueChanged",function(n,i){t.start=i;t._renderRowHeaderTable();t._renderDataTable();t.$el.trigger("mjScrollChange",i)});n=this.$el.find(".mj-horizontal-scrollbar-container");n.css({right:mjcore.MJ_VERTICAL_SCROLLBAR_WIDTH+"px"})}if(e){n=this.$el.find(".mj-horizontal-scrollbar-container");n.mjScrollBar({min:0,max:u,orientation:"horizontal"});n.on("valueChanged",function(n,i){var r=t.$el.find(".mj-data-table-container");r.css({left:-i+"px"});t.$el.trigger("mjScrollChange",i)});n.on("scrollStart",function(){s=t.$el.find(".mj-super-grid-table").width();h=t.$el.find(".mj-super-grid-table-container").width();c=t.$el.find(".mj-super-grid-row-header-table").width();u=s-h-c;n.mjScrollBar("setMinMax",0,u)})}}},close:function(){this._stopListening();this.$el.data(this,"mj-treegrid-data",null);this.$el.html("")},addRow:function(){},insertRow:function(){},deleteRow:function(){},updateRow:function(){},updateCell:function(){},exportToCSV:function(){var t=this.settings.data,i="data:text/csv;charset=utf-8,",r,n;t.forEach(function(n,r){dataString=n.join(",");i+=r<t.length?dataString+"\n":dataString});r=encodeURI(i);n=document.createElement("a");n.setAttribute("href",r);n.setAttribute("download","grid_data.csv");n.click()}};n.fn.mjSuperGrid=function(i){if(!this.length)return mjcore.mjError("mjSuperGrid: the html element to attach to '"+this.selector+"' does not exist."),null;if(t[i]){var r=n(this).data("mj-super-grid-data");if(r)return r[i].apply(r,Array.prototype.slice.call(arguments,1))}else if(i&&typeof i!="object")mjcore.mjError("Method '"+i+"' does not exist in mjSuperGrid");else return this.each(function(r,u){var f=Object.create(t);f.init(i,u);n.data(u,"mj-super-grid-data",f)})}})(jQuery)});$(document).ready(function(){(function(n){var t={_init:function(t,i){return this.widget_class="mjDropDown",this.el=i,this.$el=n(i),this.close(),this._validateData(t),this._render(),this._startListening(),this},_validateData:function(t){this.settings=n.extend({},{items:[],type:"text",multi_select:!1,component_order:["button","image","text"],text_width:null,itemRender:null,dragdrop:!1,enable_hover:!0,horizontal:!1,wrap_text:!1,dropdown_text:"select: ",width:"auto",height:"auto",disabled:!1,theme:null},t)},_render:function(){var o=this,t=this.settings,i=n("<div>",{"class":"mj-widget mj-dropdown "}),r=t.dropdown_text,u,f,e;return t.type=="text"?(u=jQuery.grep(t.items,function(n){return n.selected==!0}),u.length>0&&(r=u[0].text)):(f=jQuery.grep(t.items,function(n){return n.checked==1}),f.length>0&&(r=jQuery.map(f,function(n){return n.text}).join(","))),e=n("<div>",{"class":"mj-dropdown-handle"}),e.append(n("<div>",{"class":"mj-dropdown-handle-text mj-nowrap",html:r})),this.list_el=n("<div>",{"class":"mj-dropdown-list-container"}),i.append(e),i.append(this.list_el),this.$el.html(i),this.list_el.mjListBox(t).hide(),t.width!=null&&t.width!="auto"&&this.$el.find(".mj-widget").css("max-width",t.width),t.height!=null&&t.height!="auto"&&this.$el.find(".mj-widget").css("height",t.height),this},_startListening:function(){var t=this,i=this.settings;this._stopListening();this.$el.on("click",".mj-dropdown-handle",function(i){i.preventDefault();t.list_el.is(":visible")?(n(i.currentTarget).css({"border-bottom-left-radius":"5px","border-bottom-right-radius":"5px"}),t.list_el.hide()):(n(i.currentTarget).css({"border-bottom-left-radius":"0px","border-bottom-right-radius":"0px"}),t.list_el.show())});this.list_el.on("selected",function(n,i){t.$el.find(".mj-dropdown-handle-text").html(i.text)});this.list_el.on("checkChange",function(){var u=t.list_el.mjListBox("getChecked"),r="";n.each(u,function(n,t){r!==""&&(r+=",");r+=t.text});r==""?t.$el.find(".mj-dropdown-handle-text").html(i.dropdown_text):t.$el.find(".mj-dropdown-handle-text").html(r)});n(document).on("mouseup",this,function(n){var i=t.$el;!i.is(n.target)&&i.is(":visible")&&i.has(n.target).length===0&&(t.$el.find(".mj-dropdown-handle").css({"border-bottom-left-radius":"5px","border-bottom-right-radius":"5px"}),t.list_el.hide())})},_stopListening:function(){this.$el.off()},_resetHandleText:function(){var i=this.settings,r=this.list_el.mjListBox("getChecked"),t="";n.each(r,function(n,i){t!==""&&(t+=",");t+=i.text});t==""?this.$el.find(".mj-dropdown-handle-text").html(i.dropdown_text):this.$el.find(".mj-dropdown-handle-text").html(t)},close:function(){this.list_el&&this.list_el.mjListBox("close");this._stopListening();n.removeData(this.el,"mj-dropdown-data");this.$el.html("")}};n.fn.mjDropDown=function(i){var f,u,r,e;if(!this.length)return mjcore.mjError("mjDropDown: the html element to attach to '"+this.selector+"' does not exist."),null;if(f=["getElementAt","isCheckable","getItem","getItems","toArray","getItemAt","search","toggle","check","checkAt","uncheck","unchecktAt","getChecked","isChecked","checkAll","uncheckAll","halfTick","halfTickAll","uncheckHalfTicked","disable","disableAt","disableAll","enable","enableAt","enableAll","selectAll","deselectAll","getSelected","isSelected","select","selectAt","deselect","deselectAt","add","insert","insertAt","update","updateAt","remove","removeAt","saveState","hasChanged","sort"],t[i])return(r=n(this).data("mj-dropdown-data"),r)?r[i].apply(r,Array.prototype.slice.call(arguments,1)):null;if(n.inArray(i,f)>-1)return(u=n(this).data("mj-dropdown-data"),r=u.list_el.data("mj-listbox-data"),r)?(e=r[i].apply(r,Array.prototype.slice.call(arguments,1)),u._resetHandleText.apply(u,Array.prototype.slice.call(arguments,1)),e):null;if(i&&typeof i!="object")mjcore.mjError("mjDropDown: Method '"+i+"' does not exist in mjDropDown");else return this.each(function(r,u){var f=Object.create(t);f._init(i,u);n.data(u,"mj-dropdown-data",f)})}})(jQuery)});$(document).ready(function(){(function(n){var t={init:function(t,i){return this.widget_class="mjGrid",this.start=0,this.sort_column_index=null,this.rows=[],this.visible_rows=[],this.el=i,this.$el=n(i),this.close(),this._validateData(t),this._render(),this},_validateColumns:function(){var i=this.settings,t={text:"",data_field:null,data_type:"string",width:"auto",type:"text",class_name:null,col_header_class_name:null,editable:!1,align:"left",wrap_text:!1,fixed_columns:0,sortable:!1,sort_direction:!1,disabled:!1,group:null,hidden:!1,columnHeaderCellRender:null,cellRender:null,cellValidate:null,editTransform:null,cellFormat:null,sortFunction:null};n.each(i.columns,function(r,u){var f=n.extend({},t,u);n.extend(u,f);u.data_type=mjcore.validateString(u.data_type,["string","int","float","double","number","date"],t.data_type);u.type=mjcore.validateString(u.type,["checkbox","radiobutton","image","text","dropdown"],t.type);u.editable=mjcore.validateBool(u.editable,t.editable);u.hidden=mjcore.validateBool(u.hidden,t.hidden);u.wrap_text=mjcore.validateBool(u.wrap_text,t.wrap_text);u.disabled=mjcore.validateBool(u.disabled,t.disabled);i.sortable=mjcore.validateBool(i.sortable,t.sortable)})},_validateData:function(t){var u=this,r={columns:[],rows:[],virtual_mode:!0,page_size:10,show_column_headers:!0,borders:"grid",border_color:"efefef",dragdrop:"none",select_mode:"row",filter:null,scrollbar_width:18,scrollbar_height:18,width:"auto",height:"auto",disabled:!1,theme:null},i;this.settings=n.extend({},r,t);i=this.settings;i.rows==null&&(i.rows=[]);i.columns==null&&(i.columns=[]);i.virtual_mode=mjcore.validateBool(i.virtual_mode,r.virtual_mode);i.page_size=mjcore.validateInt(i.page_size,null,r.page_size);i.show_column_headers=mjcore.validateBool(i.show_column_headers,r.show_column_headers);typeof i.borders=="string"&&(i.borders=[i.borders]);i.dragdrop=mjcore.validateString(i.dragdrop,["none","rows","cells"],r.dragdrop);i.select_mode=mjcore.validateString(i.select_mode,["none","row","cell","multi_row","multi_cell"],r.select_mode);i.scrollbar_width=mjcore.validateInt(i.scrollbar_width,null,r.scrollbar_width);i.scrollbar_height=mjcore.validateInt(i.scrollbar_height,null,r.scrollbar_height);this._validateColumns();n.each(i.rows,function(n,t){var i=u._createRow(t);u.rows.push(i);u.visible_rows.push(i)})},_createRow:function(n){var t=this.settings;return t.select_mode=="cell"||t.select_mode=="multi_cell"?{data:n,visible:!0,selected:[],disabled:!1}:{data:n,visible:!0,selected:!1,disabled:!1}},_render:function(){var i=this,t=this.settings,n="<div class='mj-widget mj-grid '>";return n+="<div class='mj-grid-container'>",n+="<div class='mj-grid-table'>",n+="<div class='mj-grid-head'>",n+=this._renderColumnHeaders(),n+="<\/div>",n+="<div class='mj-grid-body'>",n+=this._renderRows(),n+="<\/div>",n+="<\/div>",n+="<\/div>",n+="<div class='mj-grid-vertical-scrollbar-container'><\/div>",n+="<div class='mj-grid-horizontal-scrollbar-container'><\/div>",n+="<\/div>",this.$el.html(n),this._setRowData(),this._applyCSS(),t.width!=null&&t.width!="auto"&&this.$el.find(".mj-widget").css({width:t.width,"max-width":t.width}),t.height!=null&&t.height!="auto"&&this.$el.find(".mj-widget").css("height",t.height),this._startListening(),this._createScrollBars(),this._handleAllImagesLoaded(),this},_handleAllImagesLoaded:function(){var i=this,r=this.settings,n,t;r.virtual_mode&&(n=this.$el.find("img"),n.length>0&&(t=0,this.$el.find("img").load(function(){t++;t==n.length&&i._createScrollBars()})))},_applyCSS:function(){var t=this,i=this.settings;n.each(i.columns,function(n,i){i.width&&(t.$el.find(".mj-grid-header-cell:nth-child("+(n+1)+")").css({"max-width":i.width,width:i.width}),t.$el.find(".mj-grid-cell:nth-child("+(n+1)+")").css({"max-width":i.width,width:i.width}));i.align&&(t.$el.find(".mj-grid-header-cell:nth-child("+(n+1)+")").css("text-align",i.align),t.$el.find(".mj-grid-cell:nth-child("+(n+1)+")").css("text-align",i.align))});n.each(i.borders,function(n,r){switch(r){case"grid":t.$el.find(".mj-grid").css("border-color","#"+i.border_color);break;case"right":t.$el.find(".mj-grid-cell:not(:last-child)").css("border-right-color","#"+i.border_color);t.$el.find(".mj-grid-header-cell:not(:last-child)").css("border-right-color","#"+i.border_color);break;case"bottom":t.$el.find(".mj-grid-cell").css("border-bottom-color","#"+i.border_color);t.$el.find(".mj-grid-header-cell").css("border-bottom-color","#"+i.border_color);break;case"all":t.$el.find(".mj-grid-cell").css({"border-right-color":"#"+i.border_color,"border-bottom-color":"#"+i.border_color});t.$el.find(".mj-grid-header-cell").css({"border-right-color":"#"+i.border_color,"border-bottom-color":"#"+i.border_color});t.$el.find(".mj-grid").css("border-color","#"+i.border_color)}})},_renderColumnHeaders:function(){var t="",i=this.settings;return i.show_column_headers?(i.columns.length>0&&(t+="<div class='mj-grid-header-row'>",n.each(i.columns,function(n,r){t+="<div ";var u="mj-grid-header-cell ";n<i.fixed_columns&&(u+=" mj-fixed-col");r.col_header_class_name&&(u+=r.col_header_class_name);u+=r.wrap_text?" mj-wrap":" mj-nowrap";t+="class='"+u+"'>";t+="<div class='mj-text'>";t+=r.columnHeaderCellRender&&typeof r.columnHeaderCellRender=="function"?r.columnHeaderCellRender({col:r,col_index:n,value:r.text,col_index:n}):r.text;t+="<\/div>";r.sortable&&(t+="<div class='mj-arrow-container'><div class='mj-arrow mj-arrow-down'><\/div><\/div>");t+="<\/div>"}),t+="<\/div>"),t):t},_renderCellClass:function(n,t,i){var r="mj-grid-cell",u=this.settings;return(u.select_mode=="cell"||u.select_mode=="multi_cell")&&n.selected.indexOf(t)>-1&&(r+=" mj-selected"),t.class_name&&(r+=" "+t.class_name),t.type=="text"&&(r+=t.wrap_text?" mj-wrap":" mj-nowrap"),i<u.fixed_columns&&(r+=" mj-fixed-col"),r},_renderCell:function(t,i){var u="",r,f;if(i.data_field&&(r=t.data[i.data_field],r!==null))switch(i.type){case"text":u=r;i.cellFormat&&(u=i.cellFormat({row:t,col:i,value:u}));break;case"checkbox":u=r==1||r==!0||r=="true"?"<div class='mj-checkbox-box checked'><div class='mj-tick'><\/div><\/div>":"<div class='mj-checkbox-box'><div class='mj-tick'><\/div><\/div>";break;case"radiobutton":u=r==1||r==!0||r=="true"?"<div class='mj-radio checked'><div class='mj-dot'><\/div><\/div>":"<div class='mj-radio'><div class='mj-dot'><\/div><\/div>";break;case"image":r!=null&&r!==""&&(u="<img class='mj-image' src='"+r+"' />");break;case"dropdown":f=n.grep(i.valid_values,function(n){return n.id==r});f.length>0&&(u=f[0].value)}return u},_renderRowVirtual:function(t){var f=this,u,i,r;return!t||!t.visible?"":(u=this.settings,i="mj-grid-row",(u.select_mode=="row"||u.select_mode=="multi_row")&&(t.selected&&(i+=" mj-selected"),t.disabled&&(i+=" mj-disabled")),r="<div class='"+i+"'>",n.each(u.columns,function(n,u){i=f._renderCellClass(t,u,n);r+="<div class='"+i+"'>";var e="";e=u.cellRender&&typeof u.cellRender=="function"?u.cellRender({row:t,col:u,value:t.data[u.data_field],col_index:n}):f._renderCell(t,u);r+=e;r+="<\/div>"}),r+="<\/div>")},_renderRowNonVirtual:function(t){var e=this,u,f,i,r;return!t||!t.visible?"":(u=this.settings,i="mj-grid-row",(u.select_mode=="row"||u.select_mode=="multi_row")&&(t.selected&&(i+=" mj-selected"),t.disabled&&(i+=" mj-disabled")),r="<div class='"+i+"'>",n.each(u.columns,function(n,u){u.hidden||(i=e._renderCellClass(t,u,n),r+="<div class='"+i+"'>",f="",f=u.cellRender&&typeof u.cellRender=="function"?u.cellRender({row:t,col:u,value:t.data[u.data_field],col_index:n}):e._renderCell(t,u),r+=f,r+="<\/div>")}),r+="<\/div>")},_setRowData:function(){var i=this,t=this.settings,r=this.start;n.each(this.$el.find(".mj-grid-row"),function(u,f){var e=i.visible_rows[r++];n(f).data("d",e);n.each(n(f).find(".mj-grid-cell"),function(i,r){if(i<t.columns.length){var u=t.columns[i];n(r).data("d",u)}})});n.each(this.$el.find(".mj-grid-header-row"),function(u,f){var e=i.visible_rows[r++];n(f).data("d",e);n.each(n(f).find(".mj-grid-header-cell"),function(i,r){if(i<t.columns.length){var u=t.columns[i];n(r).data("d",u)}})})},_renderRows:function(){var t="",u=this.settings,r=this.visible_rows.length,f,e,n,i;if(r==0)return t;if(u.virtual_mode)for(f=this.start+u.page_size,e=Math.min(f,r),n=this.start;n<e;n++)i=this.visible_rows[n],t+=this._renderRowVirtual(i);else for(n=0;n<r;n++)i=this.visible_rows[n],t+=this._renderRowNonVirtual(i);return t},_createScrollBars:function(){var f=this,n,t,i,u;if(!mjcore.isTouchScreen()){if(n=this.settings,!n.virtual_mode){this.$el.find(".mj-grid").css("overflow","auto");this.$el.find(".mj-grid-container").css("right","0px");return}var o=this.$el.find(".mj-grid-container"),s=o.width(),h=this.$el.find(".mj-grid-table").width(),e=0,r=0,u;if(this.visible_rows.length>n.page_size&&(r=n.scrollbar_width),h>s&&(e=n.scrollbar_height),t=this.$el.find(".mj-grid-horizontal-scrollbar-container"),i=this.$el.find(".mj-grid-vertical-scrollbar-container"),e>0){t.css({right:r,height:n.scrollbar_height});t.mjScrollBar({value:f.start,min:0,max:h-s+r,orientation:"horizontal",page_size:n.page_size,height:n.scrollbar_height});t.on("valueChanged",function(n,t){f.$el.find(".mj-grid-cell,.mj-grid-header-cell").not(".mj-fixed-col").css("left",-t)})}else u=this.$el.find(".mj-grid-horizontal-scrollbar-container .mj-scrollbar"),u&&u.length&&(t.mjScrollBar("close"),t.empty());if(r>0){i.css({bottom:e,width:n.scrollbar_width});i.mjScrollBar({value:f.start,min:0,max:this.visible_rows.length-n.page_size,page_size:n.page_size,width:n.scrollbar_width});i.on("valueChanged",function(n,t){f.scrollToRowByIndex(t,!1)});this.$el.find(".mj-grid-container").css("right",n.scrollbar_width)}else u=this.$el.find(".mj-grid-vertical-scrollbar-container .mj-scrollbar"),u.length&&(i.mjScrollBar("close"),i.empty());o.css({position:"absolute",left:0,right:r,top:0,bottom:e,overflow:"hidden"})}},_startListening:function(){var t=this,i,r;this._stopListening();i=this.settings;t=this;this.$el.on("keyup",".mj-input",function(t){var u,r,i;t.preventDefault();u=27;switch(t.keyCode){case u:if(r=n(t.currentTarget).closest(".mj-grid-row").data("d"),i=n(t.currentTarget).closest(".mj-grid-cell").data("d"),!r||!i)return;i.data_field&&(value=r.data[i.data_field],n(t.currentTarget).off(),n(t.currentTarget).parent().html(mjcore.htmlDecode(value)))}});this.$el.on("focusout",".mj-input",function(r){var o,s;r.preventDefault();var e=n(r.currentTarget).val(),f=n(r.currentTarget).closest(".mj-grid-row").data("d"),u=n(r.currentTarget).closest(".mj-grid-cell").data("d");f&&u&&(o=t.rows.indexOf(f),s=i.columns.indexOf(u),u.data_field&&(u.editTransform&&(e=u.editTransform({row:f,col:u,value:e,row_index:o,col_index:s})),u.cellValidate?u.cellValidate({row:f,col:u,value:e,row_index:o,col_index:s})?f&&u&&u.data_field&&f.data[u.data_field]!=e&&(f.data[u.data_field]=e,t.$el.trigger("cellValueChange",{row:f,col:u,value:e,row_index:o,col_index:s})):(e=f.data[u.data_field],t.$el.trigger("cellValidationError",{row:f,col:u,value:e,row_index:o,col_index:s})):f&&u&&u.data_field&&f.data[u.data_field]!=e&&(f.data[u.data_field]=e,t.$el.trigger("cellValueChange",{row:f,col:u,value:e,row_index:o,col_index:s}))),n(r.currentTarget).off(),n(r.currentTarget).parent().html(mjcore.htmlDecode(e)))});this.$el.on("click",".mj-grid-cell",function(r){var f,u,h,c,e,s,o,a,l;if((r.preventDefault(),i.select_mode!="none")&&(f=n(r.currentTarget).closest(".mj-grid-row").data("d"),u=n(r.currentTarget).data("d"),f&&u)){h=t.rows.indexOf(f);c=i.columns.indexOf(u);(i.select_mode=="cell"||i.select_mode=="row")&&t.deselectAll();switch(i.select_mode){case"cell":n(r.currentTarget).addClass("mj-selected");f.selected.push(u);break;case"multi_cell":n(r.currentTarget).addClass("mj-selected");f.selected.indexOf(u)==-1&&f.selected.push(u);break;case"row":case"multi_row":n(r.currentTarget).closest(".mj-grid-row").addClass("mj-selected");f.selected=!0}e=f.data[u.data_field];u.data_field&&!f.disabled&&(u.type=="dropdown"?(o=n(r.currentTarget).find(".mj-select"),o.length==0&&(s="<select class='mj-select'>",n.each(u.valid_values,function(n,t){var i="";e==t.id&&(i="selected");s+="<option value='"+t.id+"'"+i+">"+t.value+"<\/options>"}),s+="<\/select>",l=n(r.currentTarget).html(s),t.$el.find(".mj-select").focus().select())):u.editable&&(o=n(r.currentTarget).find("input"),o.length==0&&(e=mjcore.htmlEncode(e),a=n(r.currentTarget).width(),l=n(r.currentTarget).html("<input class='mj-input' value='"+e+"' style='width: "+(a-10)+"px;' />"),t.$el.find(".mj-input").focus().select())));t.$el.trigger("cellClick",{row:f,col:u,element:r,value:e,row_index:h,col_index:c})}});this.$el.on("click",".mj-grid-header-cell",function(i){i.preventDefault();var r=n(i.currentTarget).data("d"),u=n(i.currentTarget).index();r.sortable&&t.sort(r);t.$el.trigger("columnHeaderCellClick",{col_index:u,col:r})});this.$el.on("click",".mj-checkbox-box",function(r){var f,u,h;if(r.preventDefault(),f=n(r.currentTarget).closest(".mj-grid-row").data("d"),u=n(r.currentTarget).closest(".mj-grid-cell").data("d"),f&&u){var o=t.rows.indexOf(f),s=i.columns.indexOf(u),e=!0;if(n(r.currentTarget).hasClass("checked")&&(e=!1),u.cellValidate&&u.cellValidate({row:f,col:u,value:e,row_index:o,col_index:s})){t.$el.trigger("cellValidationError",{row:f,col:u,value:e,row_index:o,col_index:s});return}e?n(r.currentTarget).addClass("checked"):n(r.currentTarget).removeClass("checked");h=u.data_field;f&&h&&(f.data[h]=e);t.$el.trigger("checkChange",{row:f,col:u,checked:e,row_index:o,col_index:s})}});this.$el.on("change focusout",".mj-select",function(r){var u,f;if(r.preventDefault(),u=n(r.currentTarget).closest(".mj-grid-row").data("d"),f=n(r.currentTarget).closest(".mj-grid-cell").data("d"),u&&f){var s=t.rows.indexOf(u),h=i.columns.indexOf(f),e=n(r.currentTarget).val(),c=n(r.currentTarget).find("option:selected").text(),o=f.data_field;u&&o&&u.data[o]!=e&&(u.data[o]=e,t.$el.trigger("cellValueChange",{row:u,col:f,value:e,row_index:s,col_index:h}));n(r.currentTarget).parent().html(mjcore.htmlDecode(c))}});this.$el.on(" click",".mj-grid-cell .mj-radio",function(r){var f,u,e,o,s;if(r.preventDefault(),f=n(r.currentTarget).closest(".mj-grid-row").data("d"),u=n(r.currentTarget).closest(".mj-grid-cell").data("d"),f&&u){if(e=t.rows.indexOf(f),o=i.columns.indexOf(u),u.cellValidate&&u.cellValidate({row:f,col:u,value:checked,row_index:e,col_index:o})){t.$el.trigger("cellValidationError",{row:f,col:u,value:checked,row_index:e,col_index:o});return}s=u.data_field;t.uncheckColumn(u);n(r.currentTarget).addClass("checked");f&&s&&(f.data[s]=!0)}});this.$el.find(".mj-grid-table .mj-grid-header-cell").hover(function(t){n(t.currentTarget).find(".mj-arrow").show()},function(i){var r=n(i.currentTarget).index();t.sort_column_index!=r&&n(i.currentTarget).find(".mj-arrow").hide()});this.$el.find(".mj-grid-cell").on("mouseenter",function(t){var i=n(this),r=n(t.currentTarget).data("d");r.type=="text"&&this.offsetWidth<this.scrollWidth&&!i.attr("title")&&i.attr("title",n(this).text())});if(i.dragdrop=="rows"&&this.$el.find(".mj-grid-body").sortable({start:function(){var i=t.start;n.each(t.$el.find(".mj-grid-row"),function(r,u){var f=t.visible_rows[i++];n(u).data("d",f)})},update:function(){var r=[],i,u,f;for(n.each(t.$el.find(".mj-grid-row"),function(t,i){var u=n(i).data("d");r.push(u)}),i=0;i<r.length;i++)t.visible_rows[t.start+i]=r[i];if(u=0,i=t.rows.indexOf(r[0]),i>-1)for(;i<t.rows.length&&u<r.length;i++)f=t.rows[i],f.visible&&(t.rows[i]=r[u++]);t.$el.trigger("dragend")}}),i.dragdrop=="cells"&&(this.$el.find(".mj-grid-cell.draggable").draggable({axis:"x",cursor:"move",snap:!0,start:function(){},drag:function(){},stop:function(){}}),this.$el.find(".mj-grid-cell.draggable").draggable({revert:"invalid"}),this.$el.find(".mj-grid-cell.draggable").droppable({drop:function(r,u){var c=n(this).html(),y=n(u.draggable).html(),l=n(this).index(),e=n(u.draggable).index(),p=n(this).parent().index(),f=i.rows[p],o=i.columns[l],s=i.columns[e],a,v,h;o.data_field!=null&&s.data_field!=null&&f[o.data_field]!=undefined&&f[s.data_field]!=undefined&&(a=f[o.data_field],f[o.data_field]=f[s.data_field],f[s.data_field]=a);n(this).html(y);n(u.draggable).remove();v=i.columns[e];h=t._renderCellClass(f,v,e);e<n(this).parent().find(".mj-grid-cell").length?n(this).parent().find(".mj-grid-cell").eq(e).before("<div class='"+h+"'>"+c+"<\/div>"):n(this).parent().append("<div class='"+h+"'>"+c+"<\/div>");t.$el.trigger("cellDragEnd",e,l);t._applyCSS();t._setRowData();t._startListening()}})),i.virtual_mode)if(mjcore.isTouchScreen()){r=this.$el.find(".mj-grid-container");r.on("touchstart",this,this._touchstart);r.on("touchmove",this,this._touchmove);r.on("touchend",this,this._touchend)}else this.$el.on("mousewheel DOMMouseScroll wheel",".mj-grid-row",function(n){n.preventDefault();var i=t.start;n.originalEvent.wheelDelta>0?i--:i++;i>=0&&i<t.visible_rows.length&&(t.scrollToRowByIndex(i),t.$el.find(".mj-grid-vertical-scrollbar-container").mjScrollBar("set",i))})},_stopListening:function(){this.$el.off()},_touchstart:function(n){var r=n.data,t,i;n.preventDefault();t=n.originalEvent;i=0;i=t.touches?t.touches[0].pageY:t.pageY;r.touch_y=i;r.touch_busy=!1},_touchmove:function(n){var t=n.data,r=n.originalEvent,i=0,u;if((i=r.touches?r.touches[0].pageY:r.pageY,i!=t.touch_y)&&!t.touch_busy){var f=t.settings,e=t.$el.find(".mj-grid-container").height(),o=i-t.touch_y,s=o/e;(t.touch_y=i,u=f.rows.length,i=t.start+Math.floor((u-f.page_size)*s),i<0||i>=u)||(t.touch_busy=!0,t.start=i,t.redraw(),t.touch_busy=!1)}},_touchend:function(n){var t=n.data;t.touch_busy=!1},getRowElement:function(t){var r,i,f,u;if(!t)return null;for(r=this.$el.find(".mj-grid-row"),i=0,f=r.length;i<f;i++)if(u=r[i],n(u).data("d")==t)return n(u);return null},getCellElement:function(t,i){var u,f,r,o,e;if(!t||!i||(u=this.getRowElement(t),!u))return null;for(f=u.find(".mj-grid-cell"),r=0,o=f.length;r<o;r++)if(e=f[r],n(e).data("d")==i)return n(e);return null},getColHeaderElement:function(t){var r,i,f,u;if(!t)return null;for(r=this.$el.find(".mj-grid-header-cell"),i=0,f=r.length;i<f;i++)if(u=r[i],n(u).data("d")==t)return n(u);return null},disableRow:function(n){if(n){n.disabled=!0;var t=this.getRowElement(n);t&&t.addClass("mj-disabled")}},disableRowAt:function(n){if(n!=null&&!(n<0)&&!(n>=this.rows.length)){var t=this.rows[n];this.disableRow(t)}},disableAll:function(){var t=this;n.each(this.rows,function(n,t){t.disabled=!0});this.$el.find(".mj-grid-row").addClass("mj-disabled")},enableRow:function(n){if(n){n.disabled=!1;var t=this.getRowElement(n);t&&t.removeClass("mj-disabled")}},enableRowAt:function(n){if(n!=null&&!(n<0)&&!(n>=this.rows.length)){var t=this.rows[n];this.enableRow(t)}},enableAll:function(){var t=this;n.each(this.rows,function(n,t){t.disabled=!1});this.$el.find(".mj-grid-row").removeClass("mj-disabled")},getRows:function(){return this.rows},getVisibleRows:function(){return this.visible_rows},getRowAt:function(n){return n==null||n<0||n>=this.rows.length?null:this.rows[n]},findRow:function(n){var t,i;if(!n)return null;for(t=0;t<this.rows.length;t++)if(i=this.rows[t],n(i))return i;return null},getColumns:function(){return this.settings.columns},_updateRow:function(n,t,i){var f,u,r;if(n&&n.visible)if(f=this.settings,f.virtual_mode)this.redraw(),t!="update"&&this._createScrollBars();else{u=this._renderRowNonVirtual(n);switch(t){case"add":this.$el.find(".mj-grid-table").append(u);break;case"update":r=this.getRowElement(n);r&&r.replaceWith(u);break;case"remove":r=this.getRowElement(n);r&&r.off().remove();break;case"insert":i&&(r=this.getRowElement(i),r&&r.length>0&&r.before(u))}this._setRowData();this._applyCSS();this._startListening()}},addRow:function(n){if(!n)return null;var t=this._createRow(n);return this.rows.push(t),this.visible_rows.push(t),this._updateRow(t,"add"),t},insertRow:function(n,t){var r,f,e,u,i;if(n&&t&&(r=this.rows.indexOf(n),r!=-1)){for(f=this.rows.length,e=r,u=r;u<f;u++)if(n=this.rows[u],n.visible){e=this.visible_rows.indexOf(n);break}return i=this._createRow(t),this.rows.splice(r,0,i),u==f?(this.visible_rows.push(i),this._updateRow(n,"add")):(this.visible_rows.splice(e,0,i),this._updateRow(i,"insert",n)),i}},insertAt:function(n,t){if(n!=null&&!(n<0)&&!(n>=this.rows.length)){var i=this.rows[n];return this.insertRow(i,t)}},updateRow:function(n,t){if(n&&t)return n.data=t,this._updateRow(n,"update"),n},updateRowAt:function(n,t){if(n!=null&&!(n<0)&&!(n>=this.rows.length)){var i=this.rows[n];return this.updateRow(i,t),i}},updateCell:function(n,t,i){n&&t&&i&&(n.data[t.data_field]=i,this._updateRow(n,"update"))},removeRow:function(n){if(n){var t=this.rows.indexOf(n);if(t>-1)this.rows.splice(t,1);else return;t=this.visible_rows.indexOf(n);t>-1&&this.visible_rows.splice(t,1);this._updateRow(n,"remove")}},removeRowAt:function(n){if(n!=null&&!(n<0)&&!(n>=this.rows.length)){var t=this.rows[i];this.removeRow(t)}},addColumn:function(t,i){var r=this.settings;t&&(i==null&&(i=""),r.columns.push(t),this._validateColumns(),n.each(this.rows,function(n,i){t.data_field&&i.data[t.data_field]===undefined&&(i.data[t.data_field]=default_value)}),this._render())},insertColumn:function(t,i){var r=this.settings;t==null||i==null||t<0||t>=r.columns.length||(r.columns.splice(t,0,i),n.each(this.rows,function(n,t){i.data_field&&t.data[i.data_field]===undefined&&(t.data[i.data_field]="")}),this._render())},removeColumn:function(t){var r,i;t&&(r=this.settings,t.data_field&&n.each(this.rows,function(n,i){i.data[t.data_field]&&delete i.data[t.data_field]}),i=r.columns.indexOf(t),r.columns.splice(i,1),n.each(this.$el.find(".mj-grid-header-row"),function(t,r){n(r).find(".mj-grid-header-cell").eq(i).off().remove()}),n.each(this.$el.find(".mj-grid-row"),function(t,r){n(r).find(".mj-grid-cell").eq(i).off().remove()}))},removeColumnAt:function(n){var t=this.settings,i;n==null||n<0||n>=t.columns.length||(i=t.columns[n],this.removeColumn(i))},getSelected:function(){var t=[],i=this.settings;return i.select_mode=="row"||i.select_mode=="multi_row"?n.each(this.rows,function(n,i){i.selected&&t.push(i)}):n.each(this.rows,function(n,i){i.selected.length>0&&t.push(i)}),t},select:function(n,t){var r,i;if(n&&(r=this.settings,r.select_mode!="none")){(r.select_mode=="row"||r.select_mode=="cell")&&this.deselectAll();switch(r.select_mode){case"row":case"multi_row":n.selected=!0;i=this.getRowElement(n);i&&i.length>0&&i.addClass("mj-selected");break;case"cell":case"multi_cell":n.selected.indexOf(t)==-1&&n.selected.push(t);i=this.getCellElement(n,t);i&&i.length>0&&i.addClass("mj-selected")}}},selectAt:function(n){var t=this.rows[n];this.select(t,c)},deselect:function(n,t){var u=this.settings,i,r;if(u.select_mode!="none")switch(u.select_mode){case"row":case"multi_row":n.selected=!1;i=this.getRowElement(n);i&&i.length&&i.removeClass("mj-selected");break;case"cell":case"multi_cell":r=n.selected.indexOf(t);r>-1&&n.selected.splice(r,1);i=this.getCellElement(n,t);i&&i.length>0&&i.removeClass("mj-selected")}},deselectAt:function(n){var t=this.rows[n];this._deselect(t,null)},deselectAll:function(){var t=this.settings;t.select_mode!="none"&&(this.$el.find(".mj-grid-row").removeClass("mj-selected"),this.$el.find(".mj-grid-cell").removeClass("mj-selected"),t.select_mode=="cell"||t.select_mode=="multi_cell"?n.each(this.rows,function(n,t){t.selected=[]}):n.each(this.rows,function(n,t){t.selected=!1}))},_checkCell:function(t,i,r){var u=null,e=this.settings,f=e.columns.indexOf(i);switch(i.type){case"checkbox":u=n(t).find(".mj-grid-cell").eq(f).find(".mj-checkbox-box");break;case"radiobutton":u=n(t).find(".mj-grid-cell").eq(f).find(".mj-radio")}u&&u.length>0&&(r?u.addClass("checked"):u.removeClass("checked"))},checkColumn:function(t){var i=this;t&&t.data_field!=null&&(n.each(this.$el.find(".mj-grid-row"),function(n,r){i._checkCell(r,t,1)}),n.each(this.rows,function(n,i){i.data[t.data_field]=1}))},checkColumnAt:function(n){var t=this.settings,i;n<0||n>=t.columns.length||(i=t.columns[n],this.checkColumn(i))},uncheckColumn:function(t){var i=this;t&&t.data_field!=null&&(n.each(this.$el.find(".mj-grid-row"),function(n,r){i._checkCell(r,t,0)}),n.each(this.rows,function(n,i){i.data[t.data_field]=0}))},uncheckColumnAt:function(n){var t=this.settings,i;n<0||n>=t.columns.length||(i=t.columns[n],this.uncheckColumn(i))},checkCell:function(n,t){var r,i;n&&t&&(r=this.settings,n.data[t.data_field]=1,i=this.getRowElement(n),i&&i.length>-1&&this._checkCell(i,t,1))},uncheckCell:function(n,t){var r,i;n&&t&&(r=this.settings,n.data[t.data_field]=0,i=this.getRowElement(n),i&&i.length>-1&&this._checkCell(i,t,0))},sort:function(t){var u=this,f=this.settings,r,i;t&&t.data_field!=null&&(this.rows.sort(function(n,i){if(t.sortFunction)return t.sortFunction(t,n,i);var r=n.data[t.data_field],u=i.data[t.data_field];if(r==undefined||u==undefined)return 0;switch(t.data_type){case"number":case"int":case"float":case"double":r=parseFloat(r);u=parseFloat(u);isNaN(r)&&(r=n.data[t.data_field]);isNaN(u)&&(u=i.data[t.data_field])}if(t.sort_direction){if(r<u)return 1;if(r>u)return-1}else{if(r<u)return-1;if(r>u)return 1}return 0}),this.visible_rows=[],n.each(this.rows,function(n,t){t&&t.visible&&u.visible_rows.push(t)}),t.sort_direction=!t.sort_direction,r=f.columns.indexOf(t),this.sort_column_index=r,this.start=0,this.redraw(),this.$el.find(".mj-grid-header-cell .mj-arrow").hide(),i=this.$el.find(".mj-grid-header-cell").eq(r).find(".mj-arrow"),i.show(),t.sort_direction?i.addClass("mj-arrow-up").removeClass("mj-arrow-down"):i.addClass("mj-arrow-down").removeClass("mj-arrow-up"))},sortByColIndex:function(n){var t=this.settings,i;n==null||n<0||n>=t.columns.length||(i=t.columns[n],this.sort(i))},filter:function(t,i){var r=this,u=this.settings;return this.visible_rows=[],t!=null&&t!==""&&(u.filter||i)?n.each(this.rows,function(n,f){f.visible=i?i(f,t):u.filter(f,t);f.visible&&r.visible_rows.push(f)}):n.each(this.rows,function(n,t){t.visible=!0;r.visible_rows.push(t)}),this.start=0,this.redraw(),this._createScrollBars(),this.visible_rows.length},redraw:function(){var n=this._renderRows();this.$el.find(".mj-grid-body").html(n);this._setRowData();this._applyCSS();this._startListening()},_isScrolledIntoView:function(n){var t=this.$el.find(".mj-grid"),i=t.scrollTop(),u=i+t.height(),r=n.position().top,f=r+n.height();return f<=u&&r>=i},getTopRowIndex:function(){var i=this,r=this.settings,t;return r.virtual_mode?this.start:(t=null,this.$el.find(".mj-grid-row").each(function(r,u){i._isScrolledIntoView(n(u))&&!t&&(t=n(u))}),t.index())},scrollToRowByIndex:function(n,t){var r,u,i;if(n!=null){if(n<0&&(n=0),n>=this.visible_rows.length&&(n=this.visible_rows.length-1),r=this.settings,!r.virtual_mode){u=n>=this.visible_rows.length?this.$el.find(".mj-grid-row:last").position():this.$el.find(".mj-grid-row").eq(n).position();u&&this.$el.find(".mj-grid").scrollTop(u.top);return}(n>this.visible_rows.length-r.page_size&&(n=this.visible_rows.length-r.page_size),n<0&&(n=0),this.start=n,this.redraw(),mjcore.isTouchScreen())||(i=this.$el.find(".mj-grid-vertical-scrollbar-container .mj-scrollbar"),i.length&&(t==!0||t==undefined)&&this.$el.find(".mj-grid-vertical-scrollbar-container").mjScrollBar("set",n),i=this.$el.find(".mj-grid-horizontal-scrollbar-container .mj-scrollbar"),i&&i.length&&this.$el.find(".mj-grid-horizontal-scrollbar-container").mjScrollBar("set",0))}},scrollToRow:function(n){var i,t;n!=null&&(i=this.visible_rows.indexOf(n),this.scrollToRowByIndex(i),t=this.$el.find(".mj-grid-horizontal-scrollbar-container .mj-scrollbar"),t&&t.length&&this.$el.find(".mj-grid-horizontal-scrollbar-container").mjScrollBar("set",0))},setSelectMode:function(n){var t=this.settings;t.select_mode=mjcore.validateString(n,["none","row","cell","multi_row","multi_cell"],"row");this.deselectAll()},close:function(){this._stopListening();this.$el.data(this,"mj-grid-data",null);this.$el.html("")}};n.fn.mjGrid=function(i){if(!this.length)return mjcore.mjError("mjGrid: the html element to attach to '"+this.selector+"' does not exist."),null;if(t[i]){var r=n(this).data("mj-grid-data");if(r)return r[i].apply(r,Array.prototype.slice.call(arguments,1))}else if(i&&typeof i!="object")mjcore.mjError("Method '"+i+"' does not exist in mjGrid");else return this.each(function(r,u){var f=Object.create(t);f.init(i,u);n.data(u,"mj-grid-data",f)})}})(jQuery)})